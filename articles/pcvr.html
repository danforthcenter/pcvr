<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>pcvr • pcvr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="pcvr">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">pcvr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html" aria-label="Home page"><span class="fa fa-home fa-lg"></span></a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes">
<li><a class="dropdown-item" href="../articles/pcvr.html">pcvr</a></li>
    <li><a class="dropdown-item" href="../articles/longitudinal.html">Longitudinal Modeling</a></li>
    <li><a class="dropdown-item" href="../articles/roots.html">Root Phenotyping</a></li>
    <li><a class="dropdown-item" href="../articles/directional.html">Directional Statistics</a></li>
    <li><a class="dropdown-item" href="../articles/installation.html">Installation Tutorial</a></li>
    <li><a class="dropdown-item" href="../articles/pcvrTutorial_conjugate.html">Conjugate Tutorial</a></li>
    <li><a class="dropdown-item" href="../articles/pcvrTutorial_igm.html">Intermediate Growth Modeling Tutorial</a></li>
    <li><a class="dropdown-item" href="../articles/pcvrTutorial_agm.html">Advanced Growth Modeling Tutorial</a></li>
    <li><a class="dropdown-item" href="../articles/pcvrTutorial_mvt.html">Multi-Value Traits Tutorial</a></li>
    <li><a class="dropdown-item" href="../articles/field_capacity.html">Water Derived Traits Tutorial</a></li>
    <li><a class="dropdown-item" href="../articles/reading_pcv_data.html">Using online PlantCV Output</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-quarto-tutorials" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Quarto Tutorials</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-quarto-tutorials">
<li><a class="external-link dropdown-item" href="https://github.com/danforthcenter/pcvr/tree/main/tutorials/pcvrInstallation">Installation</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/danforthcenter/pcvr/tree/main/tutorials/pcvrTutorial_intro">Intro</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/danforthcenter/pcvr/tree/main/tutorials/pcvrTutorial_intermediateGrowthModeling">Growth Modeling</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/danforthcenter/pcvr/tree/main/tutorials/pcvrTutorial_advancedGrowthModeling">Advanced Growth Modeling</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/danforthcenter/pcvr/tree/main/tutorials/pcvrTutorial_conjugate">Bayesian Conjugate Priors</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/danforthcenter/pcvr/tree/crop_reporter/tutorials/pcvrTutorial_multiValueTraits">Multi-Value Traits</a></li>
  </ul>
</li>
<li class="nav-item"><a class="external-link nav-link" href="https://plantcv.org/">PlantCV</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/danforthcenter/pcvr" aria-label="View on Github"><span class="fa fa-github"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/danforthcenter/PlantCV" aria-label="View PlantCV on Github"><span class="fa fa-leaf"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>pcvr</h1>
                        <h4 data-toc-skip class="author">Josh Sumner,
DDPSC Data Science Core Facility</h4>
            
            <h4 data-toc-skip class="date">2025-07-01</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/danforthcenter/pcvr/blob/main/vignettes/pcvr.Rmd" class="external-link"><code>vignettes/pcvr.Rmd</code></a></small>
      <div class="d-none name"><code>pcvr.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="sourceCode css"><code class="sourceCode css"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">.static-code</span> {</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>  <span class="kw">background-color</span><span class="ch">:</span> <span class="cn">white</span><span class="op">;</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>  <span class="kw">border</span><span class="ch">:</span> <span class="dv">1</span><span class="dt">px</span> <span class="dv">solid</span> <span class="cn">lightgray</span><span class="op">;</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>}</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="fu">.simulated</span> {</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>  <span class="kw">background-color</span><span class="ch">:</span> <span class="cn">#EEF8FB</span><span class="op">;</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>  <span class="kw">border</span><span class="ch">:</span> <span class="dv">1</span><span class="dt">px</span> <span class="dv">solid</span> <span class="cn">#287C94</span><span class="op">;</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>}</span></code></pre></div>
<style type="text/css">
.static-code {
  background-color: white;
  border: 1px solid lightgray;
}
.simulated {
  background-color: #EEF8FB;
  border: 1px solid #287C94;
}
</style>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/danforthcenter/pcvr" class="external-link">pcvr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span> <span class="co"># for fread</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span> <span class="co"># for easy ggplot manipulation/combination</span></span></code></pre></div>
<div class="section level2">
<h2 id="example-bellwether-lemnatech-workflow">Example Bellwether (Lemnatech) Workflow<a class="anchor" aria-label="anchor" href="#example-bellwether-lemnatech-workflow"></a>
</h2>
<p>The Bellwether phenotyping facility at the Donald Danforth Plant
Science Center allows for high throughput image based phenotyping of up
to 1140 plants over the course of several weeks. This generates a
massive amount of image data which is typically analysed using plantCV,
a python based image analysis tool developed and maintained by the Data
Science Core Facility at DDPSC. The plantCV output from a Bellwether
experiment consists of numeric phenotypes commonly broken into two
categories, single value traits and multi value traits. Single value
traits are phenotypes where one image yields one value, things like
plant height or plant area. Multi value traits require multiple numbers
to describe a single image and currently are limited to color histograms
in various color spaces. Here we will focus only on the hue channel of
HSV color, but there are lots of options with your data. This package is
being developed to help with common analysis tasks that arise in using
plantCV output. If your goal or experiment seems to be unsupported then
please consider raising an <a href="https://github.com/danforthcenter/pcvr" class="external-link">issue on github</a> so we
can know what directions to take development in for the future.</p>
<p>Installation of <code>pcvr</code> from github is possible with the
<code>remotes</code> or <code>devtools</code> packages. You may need to
restart R after installing or reinstalling packages.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"joshqsumner/pcvr"</span>, build_vignettes <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/danforthcenter/pcvr" class="external-link">pcvr</a></span><span class="op">)</span></span></code></pre></div>
<p>If you clone that repository and are making edits then you can easily
use your local version with:
<code>devtools::load_all("file/path/to/local/pcvr")</code></p>
<p>Functions in <code>pcvr</code> use colorblind friendly palettes from
the <code>viridis</code> package if they specify color/fill scales. Some
functions do not specify a color/fill scale and use <code>ggplot2</code>
defaults. If you use these functions or base work off of them please be
mindful of your choices regarding color.</p>
<p>As a final note before starting into <code>pcvr</code>, this vignette
is laid out to help guide analyses from Bellwether experiments these
functions tend to be generalizable and can be used for other plantCV
data as well. There are some code chunks in this vignette that you are
only presented to demonstrate syntax and that you are not meant to run
locally if following along. Those are identified by style:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">complicatedFunction</span><span class="op">(</span><span class="st">"syntax"</span><span class="op">)</span> <span class="co"># do not run this style</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">1</span> <span class="op">+</span> <span class="fl">1</span> <span class="co"># run this style</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 2</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">support</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0.0001</span><span class="op">)</span> <span class="co"># this style is simulated data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">support</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html" class="external-link">dbeta</a></span><span class="op">(</span><span class="va">support</span>, <span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"l"</span>, main <span class="op">=</span> <span class="st">"simulated example"</span><span class="op">)</span></span></code></pre></div>
<p><img src="pcvr_files/figure-html/unnamed-chunk-6-1.png" alt="Example of simulated data styling in the vignette" width="700"></p>
<div class="section level3">
<h3 id="load-data">Load Data<a class="anchor" aria-label="anchor" href="#load-data"></a>
</h3>
<p>In this vignette we will use simulated data but there are examples on
<a href="https://danforthcenter.github.io/pcvr/">github</a> using
<code>PlantCV</code> output read from online if you run into metadata
handling problems. This simulated data picks up roughly where the
<code>Reading pcv data</code> article ends.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/growthSim.html">growthSim</a></span><span class="op">(</span><span class="st">"logistic"</span>,</span>
<span>  n <span class="op">=</span> <span class="fl">30</span>, t <span class="op">=</span> <span class="fl">25</span>,</span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="st">"A"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">140</span>, <span class="fl">155</span>, <span class="fl">150</span>, <span class="fl">165</span>, <span class="fl">180</span>, <span class="fl">190</span>, <span class="fl">175</span>, <span class="fl">185</span>, <span class="fl">200</span>, <span class="fl">220</span>, <span class="fl">210</span>, <span class="fl">205</span><span class="op">)</span>,</span>
<span>    <span class="st">"B"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">13</span>, <span class="fl">11</span>, <span class="fl">12</span>, <span class="fl">11</span>, <span class="fl">10</span>, <span class="fl">11</span>, <span class="fl">12</span>, <span class="fl">13</span>, <span class="fl">14</span>, <span class="fl">12</span>, <span class="fl">12</span>, <span class="fl">13</span><span class="op">)</span>,</span>
<span>    <span class="st">"C"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">3.25</span>, <span class="fl">3.5</span>, <span class="fl">3.1</span>, <span class="fl">2.9</span>, <span class="fl">3.4</span>, <span class="fl">3.75</span>, <span class="fl">2.9</span>, <span class="fl">3</span>, <span class="fl">3.1</span>, <span class="fl">3.25</span>, <span class="fl">3.3</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">d</span><span class="op">$</span><span class="va">genotype</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, <span class="st">"MM"</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">letters</span><span class="op">[</span><span class="fl">4</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span>, <span class="st">"B73"</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">letters</span><span class="op">[</span><span class="fl">7</span><span class="op">:</span><span class="fl">9</span><span class="op">]</span>, <span class="st">"Mo17"</span>, <span class="st">"W605S"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">d</span><span class="op">$</span><span class="va">fertilizer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">letters</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">12</span>, <span class="fl">3</span><span class="op">)</span><span class="op">]</span>, <span class="fl">0</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">letters</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">12</span>, <span class="fl">3</span><span class="op">)</span><span class="op">]</span>, <span class="fl">50</span>, <span class="fl">100</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"barcode"</span>, <span class="st">"DAS"</span>, <span class="st">"area_cm2"</span><span class="op">)</span></span>
<span><span class="va">d</span><span class="op">$</span><span class="va">height_cm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/growthSim.html">growthSim</a></span><span class="op">(</span><span class="st">"monomolecular"</span>,</span>
<span>  n <span class="op">=</span> <span class="fl">30</span>, t <span class="op">=</span> <span class="fl">25</span>,</span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="st">"A"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="fl">25</span>, <span class="fl">30</span>, <span class="fl">35</span>, <span class="fl">32</span>, <span class="fl">34</span>, <span class="fl">30</span>,</span>
<span>      <span class="fl">37</span>, <span class="fl">36</span>, <span class="fl">34</span>, <span class="fl">33</span>, <span class="fl">35</span>, <span class="fl">38</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="st">"B"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="fl">0.12</span>, <span class="fl">0.08</span>, <span class="fl">0.1</span>, <span class="fl">0.11</span>, <span class="fl">0.1</span>,</span>
<span>      <span class="fl">0.12</span>, <span class="fl">0.07</span>, <span class="fl">0.12</span>, <span class="fl">0.11</span>, <span class="fl">0.09</span>, <span class="fl">0.08</span>, <span class="fl">0.09</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span><span class="op">$</span><span class="va">y</span></span>
<span><span class="va">d</span><span class="op">$</span><span class="va">width_cm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/growthSim.html">growthSim</a></span><span class="op">(</span><span class="st">"power law"</span>,</span>
<span>  n <span class="op">=</span> <span class="fl">30</span>, t <span class="op">=</span> <span class="fl">25</span>,</span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="st">"A"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="fl">10</span>, <span class="fl">14</span>, <span class="fl">13</span>, <span class="fl">11</span>, <span class="fl">12</span>, <span class="fl">13</span>,</span>
<span>      <span class="fl">10</span>, <span class="fl">13</span>, <span class="fl">14</span>, <span class="fl">11</span>, <span class="fl">14</span>, <span class="fl">14</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="st">"B"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="fl">1.05</span>, <span class="fl">1.13</span>, <span class="fl">1.17</span>, <span class="fl">1.01</span>, <span class="fl">1.2</span>,</span>
<span>      <span class="fl">1</span>, <span class="fl">1.04</span>, <span class="fl">1.07</span>, <span class="fl">1.17</span>, <span class="fl">1.04</span>, <span class="fl">1.16</span>, <span class="fl">1.17</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span><span class="op">$</span><span class="va">y</span></span>
<span><span class="va">d</span><span class="op">$</span><span class="va">hue_circular_mean_degrees</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/growthSim.html">growthSim</a></span><span class="op">(</span><span class="st">"linear"</span>,</span>
<span>  n <span class="op">=</span> <span class="fl">30</span>, t <span class="op">=</span> <span class="fl">25</span>,</span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"A"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">12</span>, <span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">$</span><span class="va">y</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span>, <span class="fl">50</span>, <span class="fl">60</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sv_ag</span> <span class="op">&lt;-</span> <span class="va">d</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="frem">FREM<a class="anchor" aria-label="anchor" href="#frem"></a>
</h3>
<p>Now that our data is read in and has undergone some basic quality
control we want to know which phenotypes are best explained by our
design variables. The <code>frem</code> function partitions variance
using a fully random effects model (frem). Here we provide our
dataframe, the design variables, the phenotypes, and the column
representing time. By default <code>frem</code> will use the last
timepoint, but this is controlled with the <code>time</code> argument.
For this first example we mark the singular model fits
(<code>markSingular=TRUE</code>) to indicate places where
<code><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lme4::lmer</a></code> had some convergence issues. Generally these
issues are minor and do not cause problems for interpreting these
models, but you can pass additional arguments to <code><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lme4::lmer</a></code>
through additional arguments if desired.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/frem.html">frem</a></span><span class="op">(</span><span class="va">sv_ag</span>,</span>
<span>  des <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"genotype"</span>, <span class="st">"fertilizer"</span><span class="op">)</span>,</span>
<span>  phenotypes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"area_cm2"</span>, <span class="st">"height_cm"</span>, <span class="st">"width_cm"</span>, <span class="st">"hue_circular_mean_degrees"</span><span class="op">)</span>,</span>
<span>  timeCol <span class="op">=</span> <span class="st">"DAS"</span>, cor <span class="op">=</span> <span class="cn">TRUE</span>, returnData <span class="op">=</span> <span class="cn">FALSE</span>, combine <span class="op">=</span> <span class="cn">FALSE</span>, markSingular <span class="op">=</span> <span class="cn">TRUE</span>, time <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [[1]]</span></span></code></pre>
<p><img src="pcvr_files/figure-html/unnamed-chunk-8-1.png" alt="Variance partitioning using the frem function looking at genotype and fertilizer along with their interaction for 4 image based phenotypes" width="700"></p>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## [[2]]</span></span></code></pre>
<p><img src="pcvr_files/figure-html/unnamed-chunk-8-2.png" alt="Variance partitioning using the frem function looking at genotype and fertilizer along with their interaction for 4 image based phenotypes" width="700"></p>
<p>Here we look at how much variance in each phenotype was explained
over the course of the experiment. We could also specify a set of times
(<code>time = c(10:14)</code> for example) if we are most interested in
a particular timeframe.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/frem.html">frem</a></span><span class="op">(</span><span class="va">sv_ag</span>,</span>
<span>  des <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"genotype"</span>, <span class="st">"fertilizer"</span><span class="op">)</span>,</span>
<span>  phenotypes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"area_cm2"</span>, <span class="st">"height_cm"</span>, <span class="st">"width_cm"</span><span class="op">)</span>,</span>
<span>  timeCol <span class="op">=</span> <span class="st">"DAS"</span>, cor <span class="op">=</span> <span class="cn">FALSE</span>, returnData <span class="op">=</span> <span class="cn">FALSE</span>, combine <span class="op">=</span> <span class="cn">FALSE</span>, markSingular <span class="op">=</span> <span class="cn">FALSE</span>, time <span class="op">=</span> <span class="st">"all"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="pcvr_files/figure-html/unnamed-chunk-9-1.png" alt="Example of longitudinal variance partitioning using frem" width="700"></p>
<p>This informs our next steps. Hue and size based phenotypes are well
explained by our design variables so we might decide to focus more
complex analyses on those. In this experiment mini maize is one of the
genotypes and the fertilizer treatment has an option with no nitrogen,
so this intuitively makes sense and passes an eye check.</p>
</div>
<div class="section level3">
<h3 id="single-value-traits">Single Value Traits<a class="anchor" aria-label="anchor" href="#single-value-traits"></a>
</h3>
<p>Most analysis focus on single value traits, that is phenotypes where
one object in an image returns on numeric value such as area or height.
These can be compared longitudinally or with respect to individual days.
Note that we do not recommend using a PCA of the single value traits to
look for differences in your treatment groups, these traits are
interpretable on their own and are interdependent enough that a PCA is
not appropriate.</p>
<div class="section level4">
<h4 id="growth-trendlines">Growth Trendlines<a class="anchor" aria-label="anchor" href="#growth-trendlines"></a>
</h4>
<p>Trendlines help us decide what next steps make the most sense and
give a general impression of which conditions yielded healthier
plants.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">sv_ag</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">DAS</span>, y <span class="op">=</span> <span class="va">area_cm2</span>, group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">genotype</span>, <span class="va">fertilizer</span>, lex.order <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  color <span class="op">=</span> <span class="va">genotype</span></span>
<span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">fertilizer</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0"</span>, <span class="st">"50"</span>, <span class="st">"100"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">barcode</span>, <span class="va">genotype</span><span class="op">)</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"loess"</span>, se <span class="op">=</span> <span class="cn">TRUE</span>, fill <span class="op">=</span> <span class="st">"gray90"</span>, linewidth <span class="op">=</span> <span class="fl">1</span>, linetype <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">"Area"</span> <span class="op">~</span> <span class="st">"(cm"</span><span class="op">^</span><span class="fl">2</span> <span class="op">~</span> <span class="st">")"</span><span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"Genotype"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/pcv_theme.html">pcv_theme</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x.bottom <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## `geom_smooth()` using formula = 'y ~ x'</span></span></code></pre>
<p><img src="pcvr_files/figure-html/unnamed-chunk-10-1.png" alt="Non-parametric Loess lines for plant area over time" width="700"></p>
</div>
<div class="section level4">
<h4 id="single-day-comparisons">Single day comparisons<a class="anchor" aria-label="anchor" href="#single-day-comparisons"></a>
</h4>
<p>Non-longitudinal data (or single day data from larger longitudinal
data) can be compared using the <code>conjugate</code> function.
<code>conjugate</code> uses conjugate priors to make simple Bayesian
comparisons for several types of data. Optionally, region of practical
equivalence (ROPE) testing is also supported. Most distributions
supported by this function can be used with either wide or long single
value data or wide multi-value data. See <code><a href="../reference/conjugate.html">?pcvr::conjugate</a></code>
or the <a href="https://github.com/danforthcenter/pcvr/tree/main/tutorials/pcvrTutorial_conjugate" class="external-link">conjugate
tutorial</a> for details on usage and available options.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mo17_area</span> <span class="op">&lt;-</span> <span class="va">sv_ag</span><span class="op">[</span><span class="va">sv_ag</span><span class="op">$</span><span class="va">genotype</span> <span class="op">==</span> <span class="st">"Mo17"</span> <span class="op">&amp;</span> <span class="va">sv_ag</span><span class="op">$</span><span class="va">DAS</span> <span class="op">&gt;</span> <span class="fl">18</span> <span class="op">&amp;</span> <span class="va">sv_ag</span><span class="op">$</span><span class="va">fertilizer</span> <span class="op">==</span> <span class="fl">100</span>, <span class="st">"area_cm2"</span><span class="op">]</span></span>
<span><span class="va">b73_area</span> <span class="op">&lt;-</span> <span class="va">sv_ag</span><span class="op">[</span><span class="va">sv_ag</span><span class="op">$</span><span class="va">genotype</span> <span class="op">==</span> <span class="st">"B73"</span> <span class="op">&amp;</span> <span class="va">sv_ag</span><span class="op">$</span><span class="va">DAS</span> <span class="op">&gt;</span> <span class="fl">18</span> <span class="op">&amp;</span> <span class="va">sv_ag</span><span class="op">$</span><span class="va">fertilizer</span> <span class="op">==</span> <span class="fl">100</span>, <span class="st">"area_cm2"</span><span class="op">]</span></span>
<span></span>
<span><span class="va">area_res_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/conjugate.html">conjugate</a></span><span class="op">(</span>s1 <span class="op">=</span> <span class="va">mo17_area</span>, s2 <span class="op">=</span> <span class="va">b73_area</span>, method <span class="op">=</span> <span class="st">"t"</span>, rope_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">area_res_t</span></span></code></pre></div>
<pre><code><span><span class="co">## Normal distributed Mu parameter of T distributed data.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Sample 1 Prior Normal(mu = 0, sd = 10)</span></span>
<span><span class="co">##  Posterior Normal(mu = 180.856, sd = 1.38)</span></span>
<span><span class="co">## Sample 2 Prior Normal(mu = 0, sd = 10)</span></span>
<span><span class="co">##  Posterior Normal(mu = 179.441, sd = 1.095)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Posterior probability that S1 is equal to S2 = 56.001%</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Probability of the difference between Mu parameters being within [-5:5] using a % Credible Interval is 100% with an average difference of 1.44</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">##      HDE_1 HDI_1_low HDI_1_high    HDE_2 HDI_2_low HDI_2_high   hyp post.prob</span></span>
<span><span class="co">## 1 180.8557    178.65   183.0614 179.4407  177.6901   181.1914 equal 0.5600134</span></span>
<span><span class="co">##   HDE_rope HDI_rope_low HDI_rope_high rope_prob</span></span>
<span><span class="co">## 1 1.440218    -1.437485      4.270525         1</span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">area_res_t</span><span class="op">)</span></span></code></pre></div>
<p><img src="pcvr_files/figure-html/unnamed-chunk-12-1.png" alt="Posterior distributions of the Normally distributed mean of area in two genotypes at a given single timepoint showing strong evidence that any difference is within [-5, 5]" width="700"></p>
<p>Here we can see a dramatic difference in our posterior distributions
between genotypes and the distribution of differences between these
samples is entirely outside of our ROPE range.</p>
</div>
<div class="section level4">
<h4 id="relative-tolerance">Relative Tolerance<a class="anchor" aria-label="anchor" href="#relative-tolerance"></a>
</h4>
<p>Often bellwether experiments involve comparing stress tolerance
between groups. For example in this dataset we might want to know which
genotype shows the most resilience to reduced fertilizer. To easily
check this we can change out data with <code>relativeTolerance</code>.
Details on this function can be read with
<code><a href="../reference/relativeTolerance.html">?pcvr::relativeTolerance</a></code>. Note that if you are going to be
making a longitudinal model anyway then it makes more sense to use the
model to assess relative tolerance rather than transforming data into a
different unit.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/relativeTolerance.html">relativeTolerance</a></span><span class="op">(</span><span class="va">sv_ag</span>,</span>
<span>  phenotypes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"area_cm2"</span>, <span class="st">"height_cm"</span><span class="op">)</span>,</span>
<span>  grouping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fertilizer"</span>, <span class="st">"genotype"</span>, <span class="st">"DAS"</span><span class="op">)</span>, control <span class="op">=</span> <span class="st">"fertilizer"</span>, controlGroup <span class="op">=</span> <span class="st">"100"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>  <span class="va">rt</span><span class="op">[</span><span class="va">rt</span><span class="op">$</span><span class="va">phenotype</span> <span class="op">==</span> <span class="st">"area_cm2"</span> <span class="op">&amp;</span> <span class="va">rt</span><span class="op">$</span><span class="va">DAS</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span><span class="op">:</span><span class="fl">12</span><span class="op">)</span>, <span class="op">]</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">DAS</span>, y <span class="op">=</span> <span class="va">mu_rel</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">fertilizer</span>, <span class="va">genotype</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">mu_rel</span> <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">se_rel</span>, ymax <span class="op">=</span> <span class="va">mu_rel</span> <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">se_rel</span><span class="op">)</span>,</span>
<span>    position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">0.3</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/pcv_theme.html">pcv_theme</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Relative Tolerance"</span>, fill <span class="op">=</span> <span class="st">"Fertilizer\nand Genotype"</span><span class="op">)</span></span></code></pre></div>
<p><img src="pcvr_files/figure-html/unnamed-chunk-13-1.png" alt="Bar plot of relative tolerance in the area phenotype with error propogated" width="700"></p>
<p>Looking at the entire data for the area phenotype is very busy so we
might subset to look at something more specific, where we see some odd
products of the plants germinating on the bellwether system.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pd</span> <span class="op">&lt;-</span> <span class="va">rt</span><span class="op">[</span><span class="va">rt</span><span class="op">$</span><span class="va">phenotype</span> <span class="op">==</span> <span class="st">"area_cm2"</span> <span class="op">&amp;</span> <span class="va">rt</span><span class="op">$</span><span class="va">DAS</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span><span class="op">:</span><span class="fl">19</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">rt</span><span class="op">$</span><span class="va">fertilizer</span> <span class="op">==</span> <span class="st">"0"</span>, <span class="op">]</span></span>
<span><span class="va">pd</span><span class="op">$</span><span class="va">upper_2se</span> <span class="op">&lt;-</span> <span class="va">pd</span><span class="op">$</span><span class="va">mu_rel</span> <span class="op">+</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">pd</span><span class="op">$</span><span class="va">se_rel</span></span>
<span><span class="va">pd</span><span class="op">$</span><span class="va">lower_2se</span> <span class="op">&lt;-</span> <span class="va">pd</span><span class="op">$</span><span class="va">mu_rel</span> <span class="op">-</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">pd</span><span class="op">$</span><span class="va">se_rel</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">pd</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">DAS</span>, y <span class="op">=</span> <span class="va">mu_rel</span>, fill <span class="op">=</span> <span class="va">genotype</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>    ymin <span class="op">=</span> <span class="va">lower_2se</span>, ymax <span class="op">=</span> <span class="va">upper_2se</span>,</span>
<span>    group <span class="op">=</span> <span class="va">genotype</span></span>
<span>  <span class="op">)</span>, position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/pcv_theme.html">pcv_theme</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Relative Tolerance"</span><span class="op">)</span></span></code></pre></div>
<p><img src="pcvr_files/figure-html/unnamed-chunk-14-1.png" alt="Bar plot of relative tolerance in the area phenotype with error propogated showing only the unfertilized data, where there is a more distinct genotype effect." width="700"></p>
</div>
<div class="section level4">
<h4 id="cumulative-phenotypes">Cumulative Phenotypes<a class="anchor" aria-label="anchor" href="#cumulative-phenotypes"></a>
</h4>
<p>Sometimes we might want to use the cumulative difference over
time.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cumulativePheno.html">cumulativePheno</a></span><span class="op">(</span><span class="va">sv_ag</span>, phenotypes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"area_cm2"</span>, <span class="st">"height_cm"</span><span class="op">)</span>,</span>
<span>                      group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"genotype"</span>, <span class="st">"fertilizer"</span>, <span class="st">"barcode"</span><span class="op">)</span>, timeCol <span class="op">=</span> <span class="st">"DAS"</span><span class="op">)</span></span></code></pre></div>
<p>We can check that this worked correctly with trend lines:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">cp</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">DAS</span>, y <span class="op">=</span> <span class="va">area_cm2_csum</span>, color <span class="op">=</span> <span class="va">genotype</span>,</span>
<span>               group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">genotype</span>, <span class="va">barcode</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">fertilizer</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0"</span>, <span class="st">"50"</span>, <span class="st">"100"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/pcv_theme.html">pcv_theme</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">"Cumulative Sum of Area"</span> <span class="op">~</span> <span class="st">"(cm"</span><span class="op">^</span><span class="fl">2</span> <span class="op">~</span> <span class="st">")"</span><span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"Genotype"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="pcvr_files/figure-html/unnamed-chunk-16-1.png" alt="Cumulative sum of area over time showing genotype differences." width="700"></p>
<p>Note that for wide data this is just a wrapper around
<code>cumsum</code>, it is only a useful function if you are using
PlantCV datasets in wide and long but want to keep your R code
standard.</p>
</div>
<div class="section level4">
<h4 id="longitudinal-modeling">Longitudinal Modeling<a class="anchor" aria-label="anchor" href="#longitudinal-modeling"></a>
</h4>
<p>Longitudinal modeling is the most comprehensive way to use the single
value traits from a bellwether experiment. Longitudinal modeling can
also be complicated compared to single timepoint analyses. Statistical
complications including changes in variance, non-linearity, and
autocorrelation present potential problems in analyses. To address these
we recommend using hierarchical models. <code>pcvr</code> attempts to
lower the barrier to entry for these models with helper functions for
use with <code>brms</code>, <code>nlme</code>, <code>nlrq</code>,
<code>mgcv</code>, and <code>nls</code>. Here we focus only on
<code>brms</code> models, but there are <a href="https://github.com/danforthcenter/pcvr/tree/main/tutorials" class="external-link">tutorials</a>
that cover more options.</p>
<div class="section level5">
<h5 id="growth-model-forms">Growth Model Forms<a class="anchor" aria-label="anchor" href="#growth-model-forms"></a>
</h5>
<p>Based on literature and observed trends there are 13 growth models
that <code>pcvr</code> supports. The six most common of those are shown
here using the <code>growthSim</code> function but the remaining options
could be visualized in the same way.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/growthSim.html">growthSim</a></span><span class="op">(</span><span class="st">"logistic"</span>,</span>
<span>  n <span class="op">=</span> <span class="fl">20</span>, t <span class="op">=</span> <span class="fl">25</span>,</span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"A"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">160</span><span class="op">)</span>, <span class="st">"B"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">13</span>, <span class="fl">11</span><span class="op">)</span>, <span class="st">"C"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">3.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">l</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">simdf</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">y</span>, group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">group</span>, <span class="va">id</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Logistic"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">simdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/growthSim.html">growthSim</a></span><span class="op">(</span><span class="st">"gompertz"</span>,</span>
<span>  n <span class="op">=</span> <span class="fl">20</span>, t <span class="op">=</span> <span class="fl">25</span>,</span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"A"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">160</span><span class="op">)</span>, <span class="st">"B"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">13</span>, <span class="fl">11</span><span class="op">)</span>, <span class="st">"C"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.25</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">simdf</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">y</span>, group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">group</span>, <span class="va">id</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Gompertz"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">simdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/growthSim.html">growthSim</a></span><span class="op">(</span><span class="st">"monomolecular"</span>,</span>
<span>  n <span class="op">=</span> <span class="fl">20</span>, t <span class="op">=</span> <span class="fl">25</span>,</span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"A"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">160</span><span class="op">)</span>, <span class="st">"B"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.08</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">simdf</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">y</span>, group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">group</span>, <span class="va">id</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Monomolecular"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">simdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/growthSim.html">growthSim</a></span><span class="op">(</span><span class="st">"exponential"</span>,</span>
<span>  n <span class="op">=</span> <span class="fl">20</span>, t <span class="op">=</span> <span class="fl">25</span>,</span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"A"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">15</span>, <span class="fl">20</span><span class="op">)</span>, <span class="st">"B"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.095</span>, <span class="fl">0.095</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">e</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">simdf</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">y</span>, group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">group</span>, <span class="va">id</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Exponential"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">simdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/growthSim.html">growthSim</a></span><span class="op">(</span><span class="st">"linear"</span>, n <span class="op">=</span> <span class="fl">20</span>, t <span class="op">=</span> <span class="fl">25</span>, params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"A"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.1</span>, <span class="fl">0.95</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ln</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">simdf</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">y</span>, group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">group</span>, <span class="va">id</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Linear"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">simdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/growthSim.html">growthSim</a></span><span class="op">(</span><span class="st">"power law"</span>, n <span class="op">=</span> <span class="fl">20</span>, t <span class="op">=</span> <span class="fl">25</span>, params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"A"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">16</span>, <span class="fl">11</span><span class="op">)</span>, <span class="st">"B"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.75</span>, <span class="fl">0.7</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">simdf</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">y</span>, group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">group</span>, <span class="va">id</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Power Law"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span></span>
<span><span class="op">(</span><span class="va">l</span> <span class="op">+</span> <span class="va">g</span> <span class="op">+</span> <span class="va">m</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">e</span> <span class="op">+</span> <span class="va">ln</span> <span class="op">+</span> <span class="va">pl</span><span class="op">)</span></span></code></pre></div>
<p><img src="pcvr_files/figure-html/unnamed-chunk-17-1.png" alt="Showing 6 parameterized growth models supported in pcvr." width="700"></p>
<p>Typically at least one of these models will be a good fit to your
bellwether data, with gompertz models being the most broadly useful so
far. In this experiment the plants were not germinated before being
added to the machine, so we might not see asymptotic size. Still,
conceptually we know that these plants will stop growing in the near
future so we might use a gompertz model in place of the exponential
model that looks most like our loess trendlines.</p>
</div>
<div class="section level5">
<h5 id="model-setup">Model setup<a class="anchor" aria-label="anchor" href="#model-setup"></a>
</h5>
<p>Coding a multilevel Bayesian model can be a difficult and time
consuming process. Even with the greatly simplified syntax used by
<code>brms</code> this can present a barrier to entry for some people
who could benefit from using very robust models. To help get around this
potential issue for the specific case of measuring growth over time
<code>pcvr</code> includes several functions to work with
<code>brms</code>, the first of which is <code>growthSS</code>, a
self-starter helper function for use with <code><a href="https://paulbuerkner.com/brms/reference/brm.html" class="external-link">brms::brm</a></code>.</p>
<div class="section level6">
<h6 id="submodel-options">submodel options<a class="anchor" aria-label="anchor" href="#submodel-options"></a>
</h6>
<p>For the purposes of this vignette we will only consider the default
Student T model family, for examples of other model families (useful for
count or circular data especially) see the <a href="https://github.com/danforthcenter/pcvr/tree/main/tutorials/pcvrTutorial_advancedGrowthModeling" class="external-link">Advanced
Growth Modeling tutorial on github</a> or the longitudinal growth
vignette.</p>
<p>There are several ways to consider variance over time. By default
almost all modeling assumes homoscedasticity, that is constant variance
across predictor variables (time here). That assumption is very
unrealistic in biological settings since all seeds/seedlings will start
from a very low area but will grow differently through the experiment.
The <code>growthSS</code> function can use any of the main growth model
options as a model for distributional parameters (here being sigma).
Splines or asymptotic models will often yield the best fit to your
data’s variance.</p>
</div>
<div class="section level6">
<h6 id="prior-distributions">Prior Distributions<a class="anchor" aria-label="anchor" href="#prior-distributions"></a>
</h6>
<p>An important part of Bayesian statistics is setting an appropriate
prior. These represent your knowledge about the field and are used along
with your collected data to yield results. Priors should generally be
weak relative to your data, meaning that if your prior belief is wrong
then your experiment can move the posterior distribution away from the
prior in a meaningful way.</p>
<p>In <code>growthSS</code> priors can be specified as a brmsprior
object (in which case it is used as is), a named list (names
representing parameters), or a numeric vector, where values will be used
to generate lognormal priors with a long right tail. Lognormal priors
with long right tails are used because the values for our growth curves
are strictly positive and the lognormal distribution is easily
interpreted. The tail is a product of the variance, which is assumed to
be 0.25 for simplicity and to ensure priors are wide. This means that
only a location parameter needs to be provided. If a list is used then
each element of the list can be length 1 in which case each group will
use the same prior or it can be a vector of the same length as
<code>unique(data$group)</code> where <code>group</code> is your
grouping variable from the form argument to <code>growthSS</code>. If a
vector is used then a warning will be printed to check that the assumed
order of groups is correct. The <code>growthSim</code> function can be
useful in thinking about what a reasonable prior distribution might be,
although priors should not be picked by trying to get a great fit by eye
to your collected data.</p>
<p>We can check the priors made by <code>growthSS</code> with the
<code>plotPrior</code> function, which can take a list of priors or the
<code>growthSS</code> output.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">priors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"A"</span> <span class="op">=</span> <span class="fl">130</span>, <span class="st">"B"</span> <span class="op">=</span> <span class="fl">10</span>, <span class="st">"C"</span> <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="va">priorPlots</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plotPrior.html">plotPrior</a></span><span class="op">(</span><span class="va">priors</span><span class="op">)</span></span>
<span><span class="va">priorPlots</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">/</span> <span class="va">priorPlots</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">/</span> <span class="va">priorPlots</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<p><img src="pcvr_files/figure-html/unnamed-chunk-18-1.png" alt="Default pcvr lognormal prior distributions on growth model parameters." width="700"></p>
<p>Looking at the prior distributions this way is useful, but for those
still familiarizing with a given growth model the parameter values may
not be very intuitive. To help with picking reasonable priors while
familiarizing with the meaning of the model parameters the
<code>plotPrior</code> function can also simulate growth curves by
making draws from the specified prior distributions. Here is an example
of using <code>plotPrior</code> in this way to pick between possible
sets of prior distributions for a gompertz model. For asymptotic
distributions the prior on “A” is added to the y margin. For
distributions with an inflection point the prior on “B” is shown in the
x margin. Arbitrary numbers of priors can be compared in this manner,
but more than two or three can be cluttered so an iterative process is
recommended if you are learning about your growth model.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">twoPriors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"A"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">130</span><span class="op">)</span>, <span class="st">"B"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">12</span><span class="op">)</span>, <span class="st">"C"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.25</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plotPrior.html">plotPrior</a></span><span class="op">(</span><span class="va">twoPriors</span>, <span class="st">"gompertz"</span>, n <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<p><img src="pcvr_files/figure-html/unnamed-chunk-19-1.png" alt="Default pcvr lognormal prior distributions on growth model parameters and random plants simulated from the prior distributions." width="700"></p>
</div>
<div class="section level6">
<h6 id="using-growthss">Using <code>growthSS</code><a class="anchor" aria-label="anchor" href="#using-growthss"></a>
</h6>
<p>Now we’re ready to define the necessary variables in our data and use
the <code>growthSS</code> function.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sv_ag</span><span class="op">$</span><span class="va">group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">sv_ag</span><span class="op">$</span><span class="va">fertilizer</span>, <span class="va">sv_ag</span><span class="op">$</span><span class="va">genotype</span><span class="op">)</span></span></code></pre></div>
<p>The <code>brms</code> package is not always imported by
<code>pcvr</code> (since <code>dependencies</code> is NA by default when
installing from github), so before fitting models you may need to
install that package. For details on installing <a href="https://github.com/paul-buerkner/brms" class="external-link"><code>brms</code></a> and
either <a href="https://mc-stan.org/rstan/" class="external-link"><code>rstan</code></a> or <a href="https://mc-stan.org/cmdstanr/" class="external-link"><code>cmdstanr</code></a> (with
<code>cmdstanr</code> being recommended), see those packages linked
documentation. Note that if you install <code>pcvr</code> from github
with <code>dependencies=T</code> then <code>cmdstanr</code> and
<code>brms</code> will be installed and ready to use.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/paul-buerkner/brms" class="external-link">brms</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/cmdstanr/" class="external-link">cmdstanr</a></span><span class="op">)</span></span>
<span><span class="fu">cmdstanr</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/cmdstanr/reference/install_cmdstan.html" class="external-link">install_cmdstan</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Here our priors are informed by a general understanding of what we
expect to see for a plant on the bellwether system. In general the
example priors</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ss</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/growthSS.html">growthSS</a></span><span class="op">(</span></span>
<span>  model <span class="op">=</span> <span class="st">"gompertz"</span>, form <span class="op">=</span> <span class="va">area_cm2</span> <span class="op">~</span> <span class="va">DAS</span> <span class="op">|</span> <span class="va">barcode</span> <span class="op">/</span> <span class="va">group</span>, sigma <span class="op">=</span> <span class="st">"spline"</span>, df <span class="op">=</span> <span class="va">sv_ag</span>,</span>
<span>  start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"A"</span> <span class="op">=</span> <span class="fl">130</span>, <span class="st">"B"</span> <span class="op">=</span> <span class="fl">10</span>, <span class="st">"C"</span> <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"brms"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Now we have most of our model components in the <code>ss</code>
object. Since we specified a gompertz model we have three parameters,
the asymptote (<code>A</code>), the inflection point (<code>B</code>),
and the growth rate (<code>C</code>). For other model options see
<code><a href="../reference/growthSim.html">?pcvr::growthSim</a></code> for details on the parameters.</p>
<p>Before trying to fit the model it is generally a good idea to check
one last plot of the data and make sure you have everything defined
correctly.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">sv_ag</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">DAS</span>, y <span class="op">=</span> <span class="va">area_cm2</span>, group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">group</span>, <span class="va">barcode</span><span class="op">)</span>,</span>
<span>                  color <span class="op">=</span> <span class="va">group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">"Area"</span> <span class="op">~</span> <span class="st">"(cm"</span><span class="op">^</span><span class="fl">2</span> <span class="op">~</span> <span class="st">")"</span><span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"Genotype\nand Soil"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="pcvr_files/figure-html/unnamed-chunk-23-1.png" alt="Growth trendlines, drawn to check grouping in pcvr formula." width="700"></p>
<p>This looks okay, there are no strange jumps in the data or glaring
problems.</p>
</div>
</div>
<div class="section level5">
<h5 id="running-models">Running Models<a class="anchor" aria-label="anchor" href="#running-models"></a>
</h5>
<p>The <code>fitGrowth</code> function in this case will call
<code><a href="https://paulbuerkner.com/brms/reference/brm.html" class="external-link">brms::brm</a></code> which automatically uses the output from
<code>growthSS</code>. Any additional arguments to
<code><a href="https://paulbuerkner.com/brms/reference/brm.html" class="external-link">brms::brm</a></code> can still be specified, a few examples of which
are shown here.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitGrowth.html">fitGrowth</a></span><span class="op">(</span><span class="va">ss</span>,</span>
<span>  iter <span class="op">=</span> <span class="fl">1000</span>, cores <span class="op">=</span> <span class="fl">2</span>, chains <span class="op">=</span> <span class="fl">2</span>, backend <span class="op">=</span> <span class="st">"cmdstanr"</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>adapt_delta <span class="op">=</span> <span class="fl">0.999</span>, max_treedepth <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="co"># options to increase performance</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="check-model-fit">Check Model Fit<a class="anchor" aria-label="anchor" href="#check-model-fit"></a>
</h5>
<p>We can visualize credible intervals from a <code>brms</code> model
and compare that to our growth trendlines to get an intuitive
understanding of how well the model fit. Note that since this vignette
does not load brms these are only a picture of the output from
<code>growthPlot</code>. The code is present to run this locally if you
have brms installed and choose to.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/growthPlot.html">growthPlot</a></span><span class="op">(</span><span class="va">fit</span>, form <span class="op">=</span> <span class="va">area_cm2</span> <span class="op">~</span> <span class="va">DAS</span> <span class="op">|</span> <span class="va">barcode</span> <span class="op">/</span> <span class="va">group</span>, df <span class="op">=</span> <span class="va">ss</span><span class="op">$</span><span class="va">df</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">"Area"</span> <span class="op">~</span> <span class="st">"(cm"</span><span class="op">^</span><span class="fl">2</span> <span class="op">~</span> <span class="st">")"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="brmPlot1.png" alt="Posterior predictive intervals as visualized by growthPlot, showing differences in conditions"><div class="figcaption">Posterior predictive intervals as visualized by
growthPlot, showing differences in conditions</div>
</div>
</div>
<div class="section level5">
<h5 id="test-hypotheses">Test Hypotheses<a class="anchor" aria-label="anchor" href="#test-hypotheses"></a>
</h5>
<p>Now we probably have some ideas about what we want to test in our
data. The <code><a href="https://paulbuerkner.com/brms/reference/hypothesis.brmsfit.html" class="external-link">brms::hypothesis</a></code> function offers incredible
flexibility to test all kinds of hypotheses. For consistency with other
backends the <code>testGrowth</code> function calls
<code><a href="https://paulbuerkner.com/brms/reference/hypothesis.brmsfit.html" class="external-link">brms::hypothesis</a></code> to evaluate hypotheses. For some
comparisons <code>pcvr</code> has a helper function called
<code>brmViolin</code> to visualize posterior distributions and the
posterior probability of some hypotheses associated with them.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/brmViolin.html">brmViolin</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">ss</span>, <span class="st">".../A_group0.B73 &gt; 1.05"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x.bottom <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>This shows that we have a posterior probability greater than 99
percent of an asymptotic size at least 5 percent higher with the 100
type soil when compared against the 0 type soil. Note that this data
does not have any plants that reached asymptotic size, so the model uses
the incomplete data to estimate where an asymptote would be. In a normal
experiment the plants would be more mature but here the asymptote
parameter is artificially inflated for the 100 soil treatment group due
to their slower growth rate.</p>
<p>There are a lot of options for how to use this function and even more
ways to use <code><a href="https://paulbuerkner.com/brms/reference/hypothesis.brmsfit.html" class="external-link">brms::hypothesis</a></code>, so this example should not be
seen as the only way to compare your models.</p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="multi-value-traits">Multi Value Traits<a class="anchor" aria-label="anchor" href="#multi-value-traits"></a>
</h3>
<p>Working with multi value traits leads to different statistical
challenges than the single value traits. Generally reading the data in
as wide format makes for a significantly smaller object in memory terms
since there are not lots of duplicated metadata (identifiers for each
row when every image has hundreds of rows potentially). Note that for
many questions even about color it is not necessary to use the entire
color histograms. Make sure that you have a good reason to use the
complete color data before going down this particular path for too long.
As an example, a very simple comparison of the circular mean of Hue here
will show our treatment effect in this data.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">sv_ag</span><span class="op">[</span><span class="va">sv_ag</span><span class="op">$</span><span class="va">DAS</span> <span class="op">==</span> <span class="fl">18</span>, <span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">fertilizer</span>, y <span class="op">=</span> <span class="va">hue_circular_mean_degrees</span>,</span>
<span>  fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">fertilizer</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span>outlier.shape <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html" class="external-link">geom_jitter</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.05</span>, size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0"</span>, <span class="st">"50"</span>, <span class="st">"100"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/pcv_theme.html">pcv_theme</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">genotype</span>, scales <span class="op">=</span> <span class="st">"free_x"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html" class="external-link">scale_x_discrete</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0"</span>, <span class="st">"50"</span>, <span class="st">"100"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Hue Circular Mean (degrees)"</span>, x <span class="op">=</span> <span class="st">"Soil and Genotype"</span><span class="op">)</span></span></code></pre></div>
<p><img src="pcvr_files/figure-html/unnamed-chunk-27-1.png" alt="Boxplot of Hue circular mean as a single value trait for comparison with multi value traits later on." width="700"></p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">dists</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">12</span>, <span class="fl">50</span>, <span class="fl">60</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="va">i</span>, sd <span class="op">=</span> <span class="fl">15</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"rnorm"</span>, <span class="fl">12</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mvSim.html">mvSim</a></span><span class="op">(</span><span class="va">dists</span>,</span>
<span>  wide <span class="op">=</span> <span class="cn">TRUE</span>, n_samples <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  t <span class="op">=</span> <span class="fl">25</span>, model <span class="op">=</span> <span class="st">"linear"</span>,</span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"A"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">12</span>, <span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">d</span><span class="op">$</span><span class="va">group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">".*_"</span>, <span class="st">""</span>, <span class="va">d</span><span class="op">$</span><span class="va">group</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">letters</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">d</span><span class="op">$</span><span class="va">genotype</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, <span class="st">"MM"</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">letters</span><span class="op">[</span><span class="fl">4</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span>, <span class="st">"B73"</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">letters</span><span class="op">[</span><span class="fl">7</span><span class="op">:</span><span class="fl">9</span><span class="op">]</span>, <span class="st">"Mo17"</span>, <span class="st">"W605S"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">d</span><span class="op">$</span><span class="va">fertilizer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">letters</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">12</span>, <span class="fl">3</span><span class="op">)</span><span class="op">]</span>, <span class="fl">0</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">letters</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">12</span>, <span class="fl">3</span><span class="op">)</span><span class="op">]</span>, <span class="fl">50</span>, <span class="fl">100</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"DAS"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"sim_"</span>, <span class="st">"hue_frequencies_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">hue_wide</span> <span class="op">&lt;-</span> <span class="va">d</span></span></code></pre></div>
<div class="section level4">
<h4 id="joyplots">Joyplots<a class="anchor" aria-label="anchor" href="#joyplots"></a>
</h4>
<p>Joyplots are a common way to look at lots of distributions. Here we
check the hue histograms as joyplots using three days and add a new fill
for the hue colorspace. Joyplots can be made with long or wide
multi-value traits.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pcv.joyplot.html">pcv.joyplot</a></span><span class="op">(</span><span class="va">hue_wide</span><span class="op">[</span><span class="va">hue_wide</span><span class="op">$</span><span class="va">DAS</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span><span class="op">)</span>, <span class="op">]</span>,</span>
<span>  index <span class="op">=</span> <span class="st">"hue_frequencies"</span>, group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fertilizer"</span>, <span class="st">"genotype"</span><span class="op">)</span>,</span>
<span>  y <span class="op">=</span> <span class="st">"DAS"</span>, id <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span><span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradientn</a></span><span class="op">(</span>colors <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pal_hue.html" class="external-link">hue_pal</a></span><span class="op">(</span>l <span class="op">=</span> <span class="fl">65</span><span class="op">)</span><span class="op">(</span><span class="fl">360</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html" class="external-link">scale_y_discrete</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"5"</span>, <span class="st">"10"</span>, <span class="st">"15"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="pcvr_files/figure-html/unnamed-chunk-29-1.png" alt="Joyplot of Hue as a multi value trait colored by Hue along x axis." width="700"></p>
<p>As mentioned previously the <code>conjugate</code> function can be
used with wide multi-value data. To use multi value data the samples
should be data frames or matrices representing color histograms. Here we
compare our color histograms assuming a lognormal distribution and find
that they are very similar in this parameterization.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mo17_sample</span> <span class="op">&lt;-</span> <span class="va">hue_wide</span><span class="op">[</span></span>
<span>  <span class="va">hue_wide</span><span class="op">$</span><span class="va">genotype</span> <span class="op">==</span> <span class="st">"Mo17"</span> <span class="op">&amp;</span> <span class="va">hue_wide</span><span class="op">$</span><span class="va">DAS</span> <span class="op">&gt;</span> <span class="fl">18</span> <span class="op">&amp;</span> <span class="va">hue_wide</span><span class="op">$</span><span class="va">fertilizer</span> <span class="op">==</span> <span class="fl">100</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"hue_freq"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">hue_wide</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">]</span></span>
<span><span class="va">b73_sample</span> <span class="op">&lt;-</span> <span class="va">hue_wide</span><span class="op">[</span></span>
<span>  <span class="va">hue_wide</span><span class="op">$</span><span class="va">genotype</span> <span class="op">==</span> <span class="st">"B73"</span> <span class="op">&amp;</span> <span class="va">hue_wide</span><span class="op">$</span><span class="va">DAS</span> <span class="op">&gt;</span> <span class="fl">18</span> <span class="op">&amp;</span> <span class="va">hue_wide</span><span class="op">$</span><span class="va">fertilizer</span> <span class="op">==</span> <span class="fl">100</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"hue_freq"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">hue_wide</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">]</span></span>
<span></span>
<span><span class="va">hue_res_ln</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/conjugate.html">conjugate</a></span><span class="op">(</span></span>
<span>  s1 <span class="op">=</span> <span class="va">mo17_sample</span>, s2 <span class="op">=</span> <span class="va">b73_sample</span>, method <span class="op">=</span> <span class="st">"lognormal"</span>,</span>
<span>  rope_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span>, hypothesis <span class="op">=</span> <span class="st">"equal"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">hue_res_ln</span></span></code></pre></div>
<pre><code><span><span class="co">## Normal distributed Mu parameter of Lognormal distributed data.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Sample 1 Prior Normal(mu = 0, sd = 10)</span></span>
<span><span class="co">##  Posterior Normal(mu = 4.578, sd = 0.474, lognormal_sigma = 0.135)</span></span>
<span><span class="co">## Sample 2 Prior Normal(mu = 0, sd = 10)</span></span>
<span><span class="co">##  Posterior Normal(mu = 3.952, sd = 0.473, lognormal_sigma = 0.23)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Posterior probability that S1 is equal to S2 = 50.847%</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Probability of the difference between Mu parameters being within [-10:10] using a % Credible Interval is 100% with an average difference of 0.628</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">##      HDE_1 HDI_1_low HDI_1_high    HDE_2 HDI_2_low HDI_2_high   hyp post.prob</span></span>
<span><span class="co">## 1 4.578306  3.820063   5.336548 3.951622  3.195338   4.707906 equal 0.5084671</span></span>
<span><span class="co">##   HDE_rope HDI_rope_low HDI_rope_high rope_prob</span></span>
<span><span class="co">## 1 0.627561   -0.4515416      1.688398         1</span></span></code></pre>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">hue_res_ln</span><span class="op">)</span></span></code></pre></div>
<p><img src="pcvr_files/figure-html/unnamed-chunk-30-1.png" alt="Example of conjugate with multi value traits which generates the same style of plot showing posterior distributions and ROPE tests as with single value traits." width="700"></p>
</div>
<div class="section level4">
<h4 id="ordination">Ordination<a class="anchor" aria-label="anchor" href="#ordination"></a>
</h4>
<p>Ordinations are another common way to look at multi value traits. The
<code>pcadf</code> function runs ordinations and optionally returns the
PCs with metadata. Here our simulated data does has a very deterministic
pattern due.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/pcadf.html">pcadf</a></span><span class="op">(</span><span class="va">hue_wide</span>, cols <span class="op">=</span> <span class="st">"hue_frequencies"</span>, color <span class="op">=</span> <span class="st">"genotype"</span>, returnData <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">fertilizer</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0"</span>, <span class="st">"50"</span>, <span class="st">"100"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="pcvr_files/figure-html/unnamed-chunk-31-1.png" alt="Plot of PC 1 and 2 from Hue as a multi value trait." width="700"></p>
</div>
<div class="section level4">
<h4 id="earth-movers-distance">Earth Mover’s Distance<a class="anchor" aria-label="anchor" href="#earth-movers-distance"></a>
</h4>
<p>Since color data is exported from plantCV as histogram data we can
also use Earth Mover’s Distance (EMD) to compare images. Conceptually
EMD is a distance that quantifies how much work it would take to turn
one histogram into another. Here we do pairwise comparisons of all our
rows and return a long dataframe of those distances. Note that even
running several cores in parallel this can take a lot of time for larger
datasets since the number of comparisons quickly can become unwieldy.
The output also will require more work to keep analyzing, so make sure
this is what you want to be doing before using EMD to compare color
histograms. If you are only interested in a change of the mean then this
is probably not the best way to use your data.</p>
<p>Here is a fast example of a place where EMD makes a lot of sense. In
this simulated data we have five generating distributions. Normal, Log
Normal, Bimodal, Trimodal, and Uniform. We could use some gaussian
mixtures to characterize the multi-modal histograms but that will get
clunky for comparing to the unimodal or uniform distributions. The
<code>conjugate</code> function would not work here since these
distributions do not share a common parameterization. Instead, we can
use EMD.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="va">simFreqs</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">vec</span>, <span class="va">group</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">s1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">vec</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">181</span>, <span class="fl">1</span><span class="op">)</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">counts</span></span>
<span>  <span class="va">s1d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">s1</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">s1d</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"group"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"sim_"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">180</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">s1d</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">sim_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">sf</span> <span class="op">&lt;-</span> <span class="fu">simFreqs</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">50</span>, <span class="fl">10</span><span class="op">)</span>, group <span class="op">=</span> <span class="st">"normal"</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">sf</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">sf</span> <span class="op">&lt;-</span> <span class="fu">simFreqs</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">rlnorm</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">30</span><span class="op">)</span>, <span class="fl">0.25</span><span class="op">)</span>, group <span class="op">=</span> <span class="st">"lognormal"</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">sf</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">sf</span> <span class="op">&lt;-</span> <span class="fu">simFreqs</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">rlnorm</a></span><span class="op">(</span><span class="fl">125</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">15</span><span class="op">)</span>, <span class="fl">0.25</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">75</span>, <span class="fl">75</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span>, group <span class="op">=</span> <span class="st">"bimodal"</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">sf</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">sf</span> <span class="op">&lt;-</span> <span class="fu">simFreqs</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">rlnorm</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">15</span><span class="op">)</span>, <span class="fl">0.25</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">50</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">90</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span>, group <span class="op">=</span> <span class="st">"trimodal"</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">sf</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">sf</span> <span class="op">&lt;-</span> <span class="fu">simFreqs</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">1</span>, <span class="fl">180</span><span class="op">)</span>, group <span class="op">=</span> <span class="st">"uniform"</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">sf</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim_df_long</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/melt.data.table.html" class="external-link">melt</a></span><span class="op">(</span><span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">sim_df</span><span class="op">)</span>, id.vars <span class="op">=</span> <span class="st">"group"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sim_df_long</span><span class="op">$</span><span class="va">bin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"sim_"</span>, <span class="st">""</span>, <span class="va">sim_df_long</span><span class="op">$</span><span class="va">variable</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">sim_df_long</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bin</span>, y <span class="op">=</span> <span class="va">value</span>, fill <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"identity"</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/pcv_theme.html">pcv_theme</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">group</span><span class="op">)</span></span></code></pre></div>
<p><img src="pcvr_files/figure-html/unnamed-chunk-32-1.png" alt="Example of simulated Earth Mover's Distance" width="700"></p>
<p>Our plots show very different distributions, so we get EMD between
our images and see that we do have some trends shown in the resulting
heatmap.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_emd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pcv.emd.html">pcv.emd</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">sim_df</span>, cols <span class="op">=</span> <span class="st">"sim_"</span>, reorder <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"group"</span><span class="op">)</span>,</span>
<span>  mat <span class="op">=</span> <span class="cn">FALSE</span>, plot <span class="op">=</span> <span class="cn">TRUE</span>, parallel <span class="op">=</span> <span class="fl">1</span>, raiseError <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Estimated time of calculation is roughly 3.1 seconds using 1 cores in parallel.</span></span></code></pre>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_emd</span><span class="op">$</span><span class="va">plot</span></span></code></pre></div>
<p><img src="pcvr_files/figure-html/unnamed-chunk-33-1.png" alt="Heatmap of Earth Mover's Distance in simulated data, showing one group much more distinct than others." width="700"></p>
<p>Now we can filter edge strength during our network building step for
EMD &gt; 0.5, and plot our network.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pcv.net.html">pcv.net</a></span><span class="op">(</span><span class="va">sim_emd</span><span class="op">$</span><span class="va">data</span>, filter <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/net.plot.html">net.plot</a></span><span class="op">(</span><span class="va">n</span>, fill <span class="op">=</span> <span class="st">"group"</span><span class="op">)</span></span></code></pre></div>
<p><img src="pcvr_files/figure-html/unnamed-chunk-34-1.png" alt="Earth Mover's Distances represented as a network, showing how distributions cluster together with the Uniform distribution missing due to it being filtered out by the edge strength requirement." width="700"></p>
<p>The distributions separate very well from each other, but we don’t
actually see our uniform distribution here. That is because the uniform
distribution does not have self-similar replicates and is also not very
similar to the other distributions. If we change our filtering then we
can even see which generating distributions are most similar to each
other. Here we pass 0.5 as a string, which tells <code>pcv.net</code> to
use the top 50 percent of EMD values instead of EMD values &gt; 0.5.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pcv.net.html">pcv.net</a></span><span class="op">(</span><span class="va">sim_emd</span><span class="op">$</span><span class="va">data</span>, filter <span class="op">=</span> <span class="st">"0.5"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/net.plot.html">net.plot</a></span><span class="op">(</span><span class="va">n</span>, fill <span class="op">=</span> <span class="st">"group"</span><span class="op">)</span></span></code></pre></div>
<p><img src="pcvr_files/figure-html/unnamed-chunk-35-1.png" alt="Changing the network's edge strength requirement to show the Uniform distribution and how much closer connected all the gaussian mixture like distributions are comparatively." width="700"></p>
<p>Just as we’d expect, our uniform distribution shows up now and is the
most different. Now changing the edgeFilter in the <code>net.plot</code>
function would let us fine tune this plot more to show finer
distinctions between our other four generating distributions.</p>
<p>Here is an example of how we might use hue data.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">EMD</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pcv.emd.html">pcv.emd</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">hue_wide</span><span class="op">[</span><span class="va">hue_wide</span><span class="op">$</span><span class="va">DAS</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">12</span>, <span class="fl">19</span><span class="op">)</span>, <span class="op">]</span>, cols <span class="op">=</span> <span class="st">"hue_frequencies"</span>,</span>
<span>  reorder <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fertilizer"</span>, <span class="st">"genotype"</span>, <span class="st">"DAS"</span><span class="op">)</span>,</span>
<span>  mat <span class="op">=</span> <span class="cn">FALSE</span>, plot <span class="op">=</span> <span class="cn">TRUE</span>, parallel <span class="op">=</span> <span class="fl">12</span>, raiseError <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>EMD can get very heavy with large datasets. For a recent lemnatech
dataset using only the images from every 5th day there were
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mn>6332</mn><mn>2</mn></msup><annotation encoding="application/x-tex">6332^2</annotation></semantics></math>
= 40,094,224 pairwise EMD values. In long format that’s a 40 million row
dataframe, which is unwieldy. To get around this problem we might decide
to use the hue circular mean as a single value trait or to aggregate
some of our data with the <code>mv_ag</code> function.</p>
<p>Starting with our complete hue data we have 1500 image histograms.
The <code>mv_ag</code> function will take a group argument and randomly
pick members of that group to have their histograms combined. Note that
histograms are scaled to sum to 1 before they are sampled. Here we
return one example with 2 histograms kept per group and one example
where groups are summarized into 1 histogram. If there are equal or
fewer images as the <code>n_per_group</code> argument then no
aggregation is done for that group but data are rescaled.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hue_ag1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mv_ag.html">mv_ag</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">hue_wide</span>, group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"DAS"</span>, <span class="st">"genotype"</span>, <span class="st">"fertilizer"</span><span class="op">)</span>, n_per_group <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">hue_ag1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 600 183</span></span></code></pre>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hue_ag2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mv_ag.html">mv_ag</a></span><span class="op">(</span><span class="va">hue_wide</span>, group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"DAS"</span>, <span class="st">"genotype"</span>, <span class="st">"fertilizer"</span><span class="op">)</span>, n_per_group <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">hue_ag2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 300 183</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="network-analysis">Network Analysis<a class="anchor" aria-label="anchor" href="#network-analysis"></a>
</h4>
<p>As it stands our EMD data is potentially difficult to use for those
unfamiliar with distance matrix based analysis. Here we represent our
distances as a network to help use the results.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">456</span><span class="op">)</span></span>
<span><span class="va">net</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pcv.net.html">pcv.net</a></span><span class="op">(</span><span class="va">EMD</span><span class="op">$</span><span class="va">data</span>, meta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fertilizer"</span>, <span class="st">"genotype"</span>, <span class="st">"DAS"</span><span class="op">)</span>, filter <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/net.plot.html">net.plot</a></span><span class="op">(</span><span class="va">net</span>, fill <span class="op">=</span> <span class="st">"DAS"</span>, shape <span class="op">=</span> <span class="st">"fertilizer"</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>Our example network shows some clustering but real data’s patterns
are likely to be more complex:</p>
<div class="float">
<img src="network.png" alt="Network showing plants clustering by fertilizer amount and Days after Start due to Hue"><div class="figcaption">Network showing plants clustering by fertilizer
amount and Days after Start due to Hue</div>
</div>
<p>This is a much more complicated network! Parsing biological meaning
out of this would require more work than the first example with 5 very
different distributions, but there is a pretty strong cluster in the
upper right corner of plants with low fertilizer at the end of the
experiment. In general if you pick to use EMD with or without networks
start small and consider what each step should mean conceptually for
your experiment.</p>
</div>
</div>
<div class="section level3">
<h3 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h3>
<p>This vignette will be periodically updated as <code>pcvr</code>
changes. Generally the <a href="https://github.com/danforthcenter/pcvr/tree/main/tutorials" class="external-link">tutorials</a>
are updated more frequently and can be a good resource. Once again if
your goal or experiment has some set of questions or needs that are not
met so far please consider making an <a href="https://github.com/danforthcenter/pcvr" class="external-link">issue on github</a> to
help the Data Science Core continue to work on this project in ways that
will help the plantCV community.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Maintained by Josh Sumner <br> Developed in DDPSC Datascience Core Facility <br> Logo design by <a href="https://twitter.com/Kerri_Gilbert" class="external-link">Kerri Gilbert</a></p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
