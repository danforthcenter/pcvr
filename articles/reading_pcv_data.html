<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Considerations when using `PlantCV` data in `pcvr` • pcvr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Considerations when using `PlantCV` data in `pcvr`">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">pcvr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html" aria-label="Home page"><span class="fa fa-home fa-lg"></span></a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes">
<li><a class="dropdown-item" href="../articles/pcvr.html">pcvr</a></li>
    <li><a class="dropdown-item" href="../articles/longitudinal.html">Longitudinal Modeling</a></li>
    <li><a class="dropdown-item" href="../articles/roots.html">Root Phenotyping</a></li>
    <li><a class="dropdown-item" href="../articles/directional.html">Directional Statistics</a></li>
    <li><a class="dropdown-item" href="../articles/installation.html">Installation Tutorial</a></li>
    <li><a class="dropdown-item" href="../articles/pcvrTutorial_conjugate.html">Conjugate Tutorial</a></li>
    <li><a class="dropdown-item" href="../articles/pcvrTutorial_igm.html">Intermediate Growth Modeling Tutorial</a></li>
    <li><a class="dropdown-item" href="../articles/pcvrTutorial_agm.html">Advanced Growth Modeling Tutorial</a></li>
    <li><a class="dropdown-item" href="../articles/pcvrTutorial_mvt.html">Multi-Value Traits Tutorial</a></li>
    <li><a class="dropdown-item" href="../articles/field_capacity.html">Water Derived Traits Tutorial</a></li>
    <li><a class="dropdown-item" href="../articles/reading_pcv_data.html">Using online PlantCV Output</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-quarto-tutorials" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Quarto Tutorials</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-quarto-tutorials">
<li><a class="external-link dropdown-item" href="https://github.com/danforthcenter/pcvr/tree/main/tutorials/pcvrInstallation">Installation</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/danforthcenter/pcvr/tree/main/tutorials/pcvrTutorial_intro">Intro</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/danforthcenter/pcvr/tree/main/tutorials/pcvrTutorial_intermediateGrowthModeling">Growth Modeling</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/danforthcenter/pcvr/tree/main/tutorials/pcvrTutorial_advancedGrowthModeling">Advanced Growth Modeling</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/danforthcenter/pcvr/tree/main/tutorials/pcvrTutorial_conjugate">Bayesian Conjugate Priors</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/danforthcenter/pcvr/tree/crop_reporter/tutorials/pcvrTutorial_multiValueTraits">Multi-Value Traits</a></li>
  </ul>
</li>
<li class="nav-item"><a class="external-link nav-link" href="https://plantcv.org/">PlantCV</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/danforthcenter/pcvr" aria-label="View on Github"><span class="fa fa-github"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/danforthcenter/PlantCV" aria-label="View PlantCV on Github"><span class="fa fa-leaf"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Considerations when using `PlantCV` data in `pcvr`</h1>
            <h3 data-toc-skip class="subtitle">pcvr v1.1.0.0</h3>
                        <h4 data-toc-skip class="author">Josh
Sumner</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/danforthcenter/pcvr/blob/main/vignettes/articles/reading_pcv_data.Rmd" class="external-link"><code>vignettes/articles/reading_pcv_data.Rmd</code></a></small>
      <div class="d-none name"><code>reading_pcv_data.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="example-bellwether-lemnatech-workflow">Example Bellwether (Lemnatech) Workflow<a class="anchor" aria-label="anchor" href="#example-bellwether-lemnatech-workflow"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/danforthcenter/pcvr" class="external-link">pcvr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span></code></pre></div>
<p>The Bellwether phenotyping facility at the Donald Danforth Plant
Science Center allows for high throughput image based phenotyping of up
to 1140 plants over the course of several weeks. This generates a
massive amount of image data which is typically analysed using plantCV,
a python based image analysis tool developed and maintained by the Data
Science Core Facility at DDPSC. The plantCV output from a Bellwether
experiment consists of numeric phenotypes commonly broken into two
categories, single value traits and multi value traits. Single value
traits are phenotypes where one image yields one value, things like
plant height or plant area. Multi value traits require multiple numbers
to describe a single image and currently are limited to color histograms
in various color spaces. Here we will focus only on the hue channel of
HSV color, but there are lots of options with your data. This package is
being developed to help with common analysis tasks that arise in using
plantCV output. If your goal or experiment seems to be unsupported then
please consider raising an <a href="https://github.com/danforthcenter/pcvr" class="external-link">issue on github</a> so we
can know what directions to take development in for the future.</p>
<div class="section level3">
<h3 id="read-in-data">Read In Data<a class="anchor" aria-label="anchor" href="#read-in-data"></a>
</h3>
<p>This tutorial just shows some common things to check when reading in
<code>PlantCV</code> output, particularly from lemnatech style
phenotyping experiments.</p>
<div class="section level4">
<h4 id="read-pcv">
<code>read.pcv</code><a class="anchor" aria-label="anchor" href="#read-pcv"></a>
</h4>
<p>Bellwether data can be very large so this vignette will use a small
bellwether dataset that is already subset to remove most multi-value
traits (most color histograms). Both the <a href="https://github.com/joshqsumner/pcvrTestData" class="external-link">single value data</a>
and <a href="https://github.com/joshqsumner/pcvrTestData" class="external-link">multi value
data</a> are available on github. For single value traits being read
into wide format there is not a compelling reason to use
<code>read.pcv</code> in place directly calling <code>fread</code> or
<code>read.csv</code>. The benefits of <code>read.pcv</code> are only
shown if you need to filter data outside of R or if you want to use your
data in a different format than it is stored in (wide going to long and
vice versa).</p>
<p>The single value traits can be read in with <code>read.pcv</code>,
here using <code><a href="https://rdatatable.gitlab.io/data.table/reference/fread.html" class="external-link">data.table::fread</a></code> for speed.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">base_url</span> <span class="op">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/joshqsumner/pcvrTestData/main/"</span></span>
<span><span class="va">base_url2</span> <span class="op">&lt;-</span> <span class="st">"https://media.githubusercontent.com/media/joshqsumner/pcvrTestData/main/"</span></span>
<span><span class="va">sv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read.pcv.html">read.pcv</a></span><span class="op">(</span></span>
<span>  filepath <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">base_url</span>, <span class="st">"pcv4-single-value-traits.csv"</span><span class="op">)</span>,</span>
<span>  reader <span class="op">=</span> <span class="st">"fread"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>You will generally want to join some metadata to your phenotypes or
parse metadata from your barcodes. Metadata key files will generally
look and be used like this:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">key</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">base_url</span>, <span class="st">"smallPhenotyperRun_key.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">key</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##          barcode genotype fertilizer</span></span>
<span><span class="co">## 1 Em004ZDB130826       MM         50</span></span>
<span><span class="co">## 2 Em002ZDC130783      B73          0</span></span>
<span><span class="co">## 3 Em002ZDC130771      B73          0</span></span>
<span><span class="co">## 4 Em005ZDC130867     Mo17          0</span></span>
<span><span class="co">## 5 Em005ZDA130872     Mo17        100</span></span>
<span><span class="co">## 6 Em005ZDC130864     Mo17          0</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">sv</span>, <span class="va">key</span>, by <span class="op">=</span> <span class="st">"barcode"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">sv</span><span class="op">$</span><span class="va">genotype</span>, <span class="va">sv</span><span class="op">$</span><span class="va">fertilizer</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        </span></span>
<span><span class="co">##           0  50 100</span></span>
<span><span class="co">##   B73   193 133 241</span></span>
<span><span class="co">##   MM    255 208 292</span></span>
<span><span class="co">##   Mo17  364 221 304</span></span>
<span><span class="co">##   W605S 182 168 263</span></span></code></pre>
<p>If we did not have a key file then we would parse our barcodes doing
something like this:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">genotype</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">sv</span><span class="op">$</span><span class="va">barcode</span>, <span class="fl">3</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">genotype</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">genotype</span> <span class="op">==</span> <span class="st">"002"</span>, <span class="st">"B73"</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">genotype</span> <span class="op">==</span> <span class="st">"003"</span>, <span class="st">"W605S"</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">genotype</span> <span class="op">==</span> <span class="st">"004"</span>, <span class="st">"MM"</span>, <span class="st">"Mo17"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">fertilizer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">sv</span><span class="op">$</span><span class="va">barcode</span>, <span class="fl">8</span>, <span class="fl">8</span><span class="op">)</span></span>
<span><span class="va">fertilizer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">fertilizer</span> <span class="op">==</span> <span class="st">"A"</span>, <span class="fl">100</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">fertilizer</span> <span class="op">==</span> <span class="st">"B"</span>, <span class="fl">50</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">genotype</span>, <span class="va">fertilizer</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##         fertilizer</span></span>
<span><span class="co">## genotype   0  50 100</span></span>
<span><span class="co">##    B73   193 133 241</span></span>
<span><span class="co">##    MM    255 208 292</span></span>
<span><span class="co">##    Mo17  364 221 304</span></span>
<span><span class="co">##    W605S 182 168 263</span></span></code></pre>
<p>Here we’ll also convert some of the phenotypes from pixel units to
meaningful units. Here we know that the chips on our color card are
1.2cm on each side, so we can use the following conversion. You can
convert these phenotypes to whatever units you like, but you need to
know the size of the color card chips in some real unit and color
correct in plantCV so that the color chip measurements are returned.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">chip_size_px</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sv</span><span class="op">$</span><span class="va">median_color_chip_height_median</span>, <span class="va">sv</span><span class="op">$</span><span class="va">median_color_chip_width_median</span><span class="op">)</span><span class="op">)</span> <span class="co"># ~52</span></span>
<span></span>
<span><span class="va">px_per_cm</span> <span class="op">&lt;-</span> <span class="va">chip_size_px</span> <span class="op">/</span> <span class="fl">1.2</span> <span class="co"># ~ 43.5</span></span>
<span><span class="va">pixels_per_cmsq</span> <span class="op">&lt;-</span> <span class="va">px_per_cm</span><span class="op">^</span><span class="fl">2</span> <span class="co"># ~ 1890</span></span>
<span></span>
<span><span class="va">sv</span><span class="op">$</span><span class="va">area_cm2</span> <span class="op">&lt;-</span> <span class="va">sv</span><span class="op">$</span><span class="va">area_pixels</span> <span class="op">/</span> <span class="va">pixels_per_cmsq</span></span>
<span><span class="va">sv</span><span class="op">$</span><span class="va">height_cm</span> <span class="op">&lt;-</span> <span class="va">sv</span><span class="op">$</span><span class="va">height_pixels</span> <span class="op">/</span> <span class="va">px_per_cm</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="very-large-datasets">Very large datasets<a class="anchor" aria-label="anchor" href="#very-large-datasets"></a>
</h4>
<p>Sometimes large plantCV output may be too large to be read into
memory for R. In that case <code>read.pcv</code> has a
<code>filter</code> argument which will filter rows using awk through
linux/unix outside of R. That feature would work as shown below to read
only single value traits into memory. This can take a few minutes but
allows the entirely workflow to be documented in one R file.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">example</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read.pcv.html">read.pcv</a></span><span class="op">(</span><span class="st">"prohibitivelyLargeFile.csv"</span>,</span>
<span>  filters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="st">"trait in area_pixels, area_above_reference_pixels, area_below_reference_pixels"</span>,</span>
<span>    <span class="st">"sample in default"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="read-pcv-4-x">
<code>read.pcv.4.x</code><a class="anchor" aria-label="anchor" href="#read-pcv-4-x"></a>
</h4>
<p>Before the release of PlantCV version 4 there were several widely
used branches of PlantCV that output results as a single long format csv
file. The original goal of <code>read.pcv</code> was to make it easier
to work with those files. Now that the default output has changed the
<code>read.pcv</code> function has been somewhat simplified but it can
still be used for these “PlantCV 4.x” legacy style data.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read.pcv.html">read.pcv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">base_url2</span>, <span class="st">"smallPhenotyperRun.csv"</span><span class="op">)</span>,</span>
<span>  mode <span class="op">=</span> <span class="st">"wide"</span>,</span>
<span>  reader <span class="op">=</span> <span class="st">"fread"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># we can parse barcodes for the metadata that we need</span></span>
<span>  <span class="va">sv</span><span class="op">$</span><span class="va">genotype</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">sv</span><span class="op">$</span><span class="va">barcode</span>, <span class="fl">3</span>, <span class="fl">5</span><span class="op">)</span></span>
<span>  <span class="va">sv</span><span class="op">$</span><span class="va">genotype</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">sv</span><span class="op">$</span><span class="va">genotype</span> <span class="op">==</span> <span class="st">"002"</span>, <span class="st">"B73"</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">sv</span><span class="op">$</span><span class="va">genotype</span> <span class="op">==</span> <span class="st">"003"</span>, <span class="st">"W605S"</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">sv</span><span class="op">$</span><span class="va">genotype</span> <span class="op">==</span> <span class="st">"004"</span>, <span class="st">"MM"</span>, <span class="st">"Mo17"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">sv</span><span class="op">$</span><span class="va">fertilizer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">sv</span><span class="op">$</span><span class="va">barcode</span>, <span class="fl">8</span>, <span class="fl">8</span><span class="op">)</span></span>
<span>  <span class="va">sv</span><span class="op">$</span><span class="va">fertilizer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">sv</span><span class="op">$</span><span class="va">fertilizer</span> <span class="op">==</span> <span class="st">"A"</span>, <span class="st">"100"</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">sv</span><span class="op">$</span><span class="va">fertilizer</span> <span class="op">==</span> <span class="st">"B"</span>, <span class="st">"50"</span>, <span class="st">"0"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span> <span class="co"># or we might use a key file and join it to our data</span></span>
<span>  <span class="va">key</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">base_url</span>, <span class="st">"smallPhenotyperRun_key.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">sv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">sv</span>, <span class="va">key</span>, by <span class="op">=</span> <span class="st">"barcode"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="read-pcv-3">
<code>read.pcv.3</code><a class="anchor" aria-label="anchor" href="#read-pcv-3"></a>
</h4>
<p>Legacy Bellwether data (plantCV version 3 output) can also be read in
with <code>read.pcv.3</code> which is a wrapper around
<code>read.pcv</code> which attempts to do several common tasks related
bellwether data joining internally. This should be considered
experimental as it is based on plantCV version 3 and earlier
outputs/bellwether experiments can take many formats and this has only
been considered with a few datasets. With the older plantCV output the
data is already in a wider format so here the default mode is “long”.
Note that while <code>read.pcv</code> works fine with this older data
and still has some added benefits the reasons to use it in place of
<code><a href="https://rdatatable.gitlab.io/data.table/reference/fread.html" class="external-link">data.table::fread</a></code> or <code>base::read.csv</code> are less
compelling.</p>
<p>Here we have examples of reading in various amounts of plantCV 3
bellwether data. In the final example we also list a conversion to take
area from pixels to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mtext mathvariant="normal">cm</mtext><mn>2</mn></msup><annotation encoding="application/x-tex">\text{cm}^2</annotation></semantics></math>
for the 5MP camera that was used prior to 2023. Note that the conversion
would change for a different camera such as the current 18MP camera. It
is a good idea to check your color chip sizes if you are not sure about
the appropriate conversion.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">onlyPhenos</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read.pcv.3.html">read.pcv.3</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">base_url</span>, <span class="st">"pcv3Phenos.csv"</span><span class="op">)</span>, metaCol <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">onlyPhenos</span><span class="op">)</span></span>
<span></span>
<span><span class="va">phenosAndMeta</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read.pcv.3.html">read.pcv.3</a></span><span class="op">(</span></span>
<span>  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">base_url</span>, <span class="st">"pcv3Phenos.csv"</span><span class="op">)</span>, metaCol <span class="op">=</span> <span class="st">"meta"</span>,</span>
<span>  metaForm <span class="op">=</span> <span class="st">"vis_view_angle_zoom_horizontal_gain_exposure_v_new_n_rep"</span>,</span>
<span>  joinSnapshot <span class="op">=</span> <span class="st">"id"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">phenosAndMeta</span><span class="op">)</span></span>
<span></span>
<span><span class="va">all</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read.pcv.3.html">read.pcv.3</a></span><span class="op">(</span></span>
<span>  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">base_url</span>, <span class="st">"pcv3Phenos.csv"</span><span class="op">)</span>,</span>
<span>  snapshotFile <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">base_url</span>, <span class="st">"pcv3Snapshot.csv"</span><span class="op">)</span>,</span>
<span>  designFile <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">base_url</span>, <span class="st">"pcv3Design.csv"</span><span class="op">)</span>,</span>
<span>  metaCol <span class="op">=</span> <span class="st">"meta"</span>, metaForm <span class="op">=</span> <span class="st">"vis_view_angle_zoom_horizontal_gain_exposure_v_new_n_rep"</span>,</span>
<span>  joinSnapshot <span class="op">=</span> <span class="st">"id"</span>, conversions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>area <span class="op">=</span> <span class="fl">13.2</span> <span class="op">*</span> <span class="fl">3.7</span> <span class="op">/</span> <span class="fl">46856</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">all</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="other-metadata">Other metadata<a class="anchor" aria-label="anchor" href="#other-metadata"></a>
</h4>
<p>Often we want to convert our timestamp data from the lemnatech into
either days after start (DAS), days after planting (DAP), or days after
emergence (DAE). By default the <code>pcv.time</code> function will add
columns called DAS, DAP, and DAE to your data. Days after emergence
requires using a phenotype and a value to classify emergence. Here an
area greater than 10 pixels is considered an emerged plant. In this
example with a planting delay of 0 DAP and DAE will be the same, but
both are still created for the purpose of the example.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pcv.time.html">pcv.time</a></span><span class="op">(</span><span class="va">sv</span>,</span>
<span>  plantingDelay <span class="op">=</span> <span class="fl">0</span>, phenotype <span class="op">=</span> <span class="st">"area_pixels"</span>, cutoff <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  timeCol <span class="op">=</span> <span class="st">"timestamp"</span>, group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"barcode"</span>, <span class="st">"rotation"</span><span class="op">)</span>, plot <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">out</span><span class="op">$</span><span class="va">plot</span></span></code></pre></div>
<pre><code><span><span class="co">## [[1]]</span></span></code></pre>
<p><img src="reading_pcv_data_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## [[2]]</span></span></code></pre>
<p><img src="reading_pcv_data_files/figure-html/unnamed-chunk-9-2.png" width="700"></p>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## [[3]]</span></span></code></pre>
<p><img src="reading_pcv_data_files/figure-html/unnamed-chunk-9-3.png" width="700"></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sv</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">$</span><span class="va">data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">sv</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 2824   52</span></span></code></pre>
<p>Note that in these plots, and particularly clearly in the DAE plot,
there are lots of plants which show a vertical line on their last day,
indicating that our grouping might be incorrect. For this data that is
due to the imaging schedule changing and getting 2 separate images at
each rotation on the last day.</p>
<p>Before moving on we’ll also check the grouping in our data. Here we
see that we have lots of plants with more than one image per day.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/checkGroups.html">checkGroups</a></span><span class="op">(</span><span class="va">sv</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"DAS"</span>, <span class="st">"barcode"</span>, <span class="st">"rotation"</span>, <span class="st">"genotype"</span>, <span class="st">"fertilizer"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Grouping is unique</span></span></code></pre>
<p>We can combine images taken at different angles of the same plant on
a given day with <code>aggregate</code>, where we will also remove some
columns we aren’t using. In this case we use the mean of observations,
but some people prefer a sum. Either way is fine. Here we also remove
the DAE and DAP columns since we will not be using them.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">phenotypes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">sv</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">19</span><span class="op">:</span><span class="fl">35</span>, <span class="fl">43</span><span class="op">:</span><span class="fl">45</span>, <span class="fl">48</span><span class="op">:</span><span class="fl">49</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">phenoForm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"cbind("</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">phenotypes</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>, <span class="st">")"</span><span class="op">)</span></span>
<span><span class="va">groupForm</span> <span class="op">&lt;-</span> <span class="st">"DAS+timestamp+barcode+genotype+fertilizer"</span></span>
<span><span class="va">form</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">as.formula</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">phenoForm</span>, <span class="st">"~"</span>, <span class="va">groupForm</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sv_ag_with_outliers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">form</span>, data <span class="op">=</span> <span class="va">sv</span>, <span class="va">mean</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">sv_ag_with_outliers</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1450   27</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="outlier-removal">Outlier Removal<a class="anchor" aria-label="anchor" href="#outlier-removal"></a>
</h4>
<p>The <code>pcv.outliers</code> function can be used to remove outliers
relative to a phenotype using cook’s distance. Here due to the
experimental design having these plants germinate on the machine around
1 percent of data are removed as outliers. The plot shows removed data
points in red, although here that is hard to see.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pcv.outliers.html">pcv.outliers</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">sv_ag_with_outliers</span>, phenotype <span class="op">=</span> <span class="st">"area_pixels"</span>,</span>
<span>  group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"DAS"</span>, <span class="st">"genotype"</span>, <span class="st">"fertilizer"</span><span class="op">)</span>, plotgroup <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"barcode"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in pcv.outliers(df = sv_ag_with_outliers, phenotype = "area_pixels", :</span></span>
<span><span class="co">## 16 groupings had all observations removed</span></span></code></pre>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sv_ag</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">$</span><span class="va">data</span></span>
<span><span class="va">out</span><span class="op">$</span><span class="va">plot</span></span></code></pre></div>
<p><img src="reading_pcv_data_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">sv_ag</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1327   27</span></span></code></pre>
<p>It is also useful to check our grouping assumptions again, here we
see that there are some plants with multiple images from a single
day.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/checkGroups.html">checkGroups</a></span><span class="op">(</span><span class="va">sv_ag</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"DAS"</span>, <span class="st">"barcode"</span>, <span class="st">"genotype"</span>, <span class="st">"fertilizer"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Grouping is unique</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="watering-data">Watering Data<a class="anchor" aria-label="anchor" href="#watering-data"></a>
</h4>
<p>We might also want to check the watering data, which can be read
easily from json with <code>pcv.water</code>.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">water</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pcv.water.html">pcv.water</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">base_url</span>, <span class="st">"metadata.json"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Using the first watering time, 2023-04-13 23:28:17.58, as beginning of experiment to assign DAS</span></span></code></pre>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">water</span><span class="op">$</span><span class="va">genotype</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">water</span><span class="op">$</span><span class="va">barcode</span>, <span class="fl">3</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">water</span><span class="op">$</span><span class="va">genotype</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">water</span><span class="op">$</span><span class="va">genotype</span> <span class="op">==</span> <span class="st">"002"</span>, <span class="st">"B73"</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">water</span><span class="op">$</span><span class="va">genotype</span> <span class="op">==</span> <span class="st">"003"</span>, <span class="st">"W605S"</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">water</span><span class="op">$</span><span class="va">genotype</span> <span class="op">==</span> <span class="st">"004"</span>, <span class="st">"MM"</span>, <span class="st">"Mo17"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">water</span><span class="op">$</span><span class="va">fertilizer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">water</span><span class="op">$</span><span class="va">barcode</span>, <span class="fl">8</span>, <span class="fl">8</span><span class="op">)</span></span>
<span><span class="va">water</span><span class="op">$</span><span class="va">fertilizer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">water</span><span class="op">$</span><span class="va">fertilizer</span> <span class="op">==</span> <span class="st">"A"</span>, <span class="st">"100"</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">water</span><span class="op">$</span><span class="va">fertilizer</span> <span class="op">==</span> <span class="st">"B"</span>, <span class="st">"50"</span>, <span class="st">"0"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">water</span><span class="op">[</span><span class="va">water</span><span class="op">$</span><span class="va">weight_after</span> <span class="op">!=</span> <span class="op">-</span><span class="fl">1</span>, <span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">DAS</span>,</span>
<span>  y <span class="op">=</span> <span class="va">water_amount</span>, group <span class="op">=</span> <span class="va">barcode</span>, color <span class="op">=</span> <span class="va">genotype</span></span>
<span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">fertilizer</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0"</span>, <span class="st">"50"</span>, <span class="st">"100"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/pcv_theme.html">pcv_theme</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Condition"</span>, override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Watering Amount (g)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reading_pcv_data_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
<p>A common use for watering data is to look at water use efficiency
(WUE). Here we can calculate an approximation of WUE based on the change
in some phenotype (area) over the change in weight between waterings.
Note that the plants in this example are very young and as such the data
in this example is dominated by noise.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pwue.html">pwue</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">sv_ag</span>, w <span class="op">=</span> <span class="va">water</span>, pheno <span class="op">=</span> <span class="st">"area_pixels"</span>, time <span class="op">=</span> <span class="st">"timestamp"</span>, id <span class="op">=</span> <span class="st">"barcode"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">test</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">DAS</span>, y <span class="op">=</span> <span class="va">pWUE</span>, color <span class="op">=</span> <span class="va">genotype</span>, group <span class="op">=</span> <span class="va">barcode</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">"Pseudo WUE ("</span> <span class="op">~</span> <span class="fu">frac</span><span class="op">(</span></span>
<span>    <span class="va">Delta</span> <span class="op">~</span> <span class="fu">textstyle</span><span class="op">(</span><span class="st">"Area"</span><span class="op">)</span><span class="op">[</span><span class="st">" pixels"</span><span class="op">]</span>,</span>
<span>    <span class="va">Delta</span> <span class="op">~</span> <span class="fu">textstyle</span><span class="op">(</span><span class="st">"Weight"</span><span class="op">)</span><span class="op">[</span><span class="st">" g"</span><span class="op">]</span></span>
<span>  <span class="op">)</span> <span class="op">~</span> <span class="st">")"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/pcv_theme.html">pcv_theme</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Removed 86 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">## (`geom_line()`).</span></span></code></pre>
<p><img src="reading_pcv_data_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
</div>
</div>
<div class="section level3">
<h3 id="multi-value-traits">Multi Value Traits<a class="anchor" aria-label="anchor" href="#multi-value-traits"></a>
</h3>
<p>We take similar steps in working with multi-value trait data.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hue_wide</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read.pcv.html">read.pcv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">base_url2</span>, <span class="st">"pcv4-multi-value-traits.csv"</span><span class="op">)</span>,</span>
<span>  mode <span class="op">=</span> <span class="st">"wide"</span>, reader <span class="op">=</span> <span class="st">"fread"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">hue_wide</span><span class="op">$</span><span class="va">genotype</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">hue_wide</span><span class="op">$</span><span class="va">barcode</span>, <span class="fl">3</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">hue_wide</span><span class="op">$</span><span class="va">genotype</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">hue_wide</span><span class="op">$</span><span class="va">genotype</span> <span class="op">==</span> <span class="st">"002"</span>, <span class="st">"B73"</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">hue_wide</span><span class="op">$</span><span class="va">genotype</span> <span class="op">==</span> <span class="st">"003"</span>, <span class="st">"W605S"</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">hue_wide</span><span class="op">$</span><span class="va">genotype</span> <span class="op">==</span> <span class="st">"004"</span>, <span class="st">"MM"</span>, <span class="st">"Mo17"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">hue_wide</span><span class="op">$</span><span class="va">fertilizer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">hue_wide</span><span class="op">$</span><span class="va">barcode</span>, <span class="fl">8</span>, <span class="fl">8</span><span class="op">)</span></span>
<span><span class="va">hue_wide</span><span class="op">$</span><span class="va">fertilizer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">hue_wide</span><span class="op">$</span><span class="va">fertilizer</span> <span class="op">==</span> <span class="st">"A"</span>, <span class="st">"100"</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">hue_wide</span><span class="op">$</span><span class="va">fertilizer</span> <span class="op">==</span> <span class="st">"B"</span>, <span class="st">"50"</span>, <span class="st">"0"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">hue_wide</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pcv.time.html">pcv.time</a></span><span class="op">(</span><span class="va">hue_wide</span>, timeCol <span class="op">=</span> <span class="st">"timestamp"</span>, group <span class="op">=</span> <span class="st">"barcode"</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">phenotypes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">hue_wide</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"hue_frequencies"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">hue_wide</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">phenoForm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"cbind("</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">phenotypes</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>, <span class="st">")"</span><span class="op">)</span></span>
<span><span class="va">groupForm</span> <span class="op">&lt;-</span> <span class="st">"DAS+barcode+genotype+fertilizer"</span></span>
<span><span class="va">form</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">as.formula</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">phenoForm</span>, <span class="st">"~"</span>, <span class="va">groupForm</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">hue_wide</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">form</span>, data <span class="op">=</span> <span class="va">hue_wide</span>, <span class="va">mean</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h3>
<p>These data can be used in the same way as the simulated data in the
Bellwether vignette. The Bellwether vignette originally used these data,
but for compatibility with <code>CRAN</code> standards now uses lighter
simulated data rather than data hosted online. See that or other
vignettes/articles for notes about analysis.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Maintained by Josh Sumner <br> Developed in DDPSC Datascience Core Facility <br> Logo design by <a href="https://twitter.com/Kerri_Gilbert" class="external-link">Kerri Gilbert</a></p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
