<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Root Traits • pcvr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Root Traits">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">pcvr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home fa-lg"></span></a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Vignettes</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-quarto-tutorials" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Quarto Tutorials</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-quarto-tutorials">
<li><a class="external-link dropdown-item" href="https://github.com/danforthcenter/pcvr/tree/main/tutorials/pcvrInstallation">Installation</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/danforthcenter/pcvr/tree/main/tutorials/pcvrTutorial_intro">Intro</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/danforthcenter/pcvr/tree/main/tutorials/pcvrTutorial_intermediateGrowthModeling">Growth Modeling</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/danforthcenter/pcvr/tree/main/tutorials/pcvrTutorial_advancedGrowthModeling">Advanced Growth Modeling</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/danforthcenter/pcvr/tree/main/tutorials/pcvrTutorial_conjugate">Bayesian Conjugate Priors</a></li>
  </ul>
</li>
<li class="nav-item"><a class="external-link nav-link" href="https://plantcv.org/">PlantCV</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/danforthcenter/pcvr"><span class="fa fa-github"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/danforthcenter/PlantCV"><span class="fa fa-leaf"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Root Traits</h1>
            <h3 data-toc-skip class="subtitle">pcvr v0.1.0</h3>
                        <h4 data-toc-skip class="author">Josh Sumner,
DDPSC Data Science Core Facility</h4>
            
            <h4 data-toc-skip class="date">2024-04-22</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/danforthcenter/pcvr/blob/main/vignettes/roots.Rmd" class="external-link"><code>vignettes/roots.Rmd</code></a></small>
      <div class="d-none name"><code>roots.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="root-imaging-data">Root imaging data<a class="anchor" aria-label="anchor" href="#root-imaging-data"></a>
</h2>
<p>Root imaging is an emerging application of <code>PlantCV</code>. Due
to the nature of available technologies for root imaging the output
tends to be noisy and there are a different set of phenotypes that may
be interesting for researchers. Fundamentally analysis should be very
similar for most phenotypes, but in the interest of providing an example
for root-focused researchers we will go over a few options for root data
output from <code>PlantCV</code>. For this vignette we will work with
simulated data based off of mini rhyzotron data collected from Fischer
farms in the Fall of 2023.</p>
</div>
<div class="section level2">
<h2 id="simulating-minirhyzotron-data">Simulating Minirhyzotron data<a class="anchor" aria-label="anchor" href="#simulating-minirhyzotron-data"></a>
</h2>
<p>The data is simulated as a mixture between a Uniform background
distribution and N gaussian distributions where N follows a uniform
distribution and each gaussian is parameterized by mu and sigma. Mu also
follows a uniform distribution and sigma follows a half-normal
distribution. Pixels are assigned to the background or the gaussian
mixture component according to theta. Pixels assigned to the gaussian
mixture are randomly assigned to each of the N gaussian distributions.
See the <code>rRhyzoDist</code> function below. We also define functions
that will generate single value traits from the MV frequencies.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rRhyzoDist</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">theta</span> <span class="op">=</span> <span class="fl">0.3</span>, <span class="va">u1_max</span> <span class="op">=</span> <span class="fl">20</span>, <span class="va">u2_max</span> <span class="op">=</span> <span class="fl">5500</span>, <span class="va">sd</span> <span class="op">=</span> <span class="fl">200</span>, <span class="va">abs_max</span> <span class="op">=</span> <span class="fl">5500</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co">#* split n_pixels based on theta into background and gaussians</span></span>
<span>  <span class="va">n_unif_pixels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">n</span> <span class="op">*</span> <span class="va">theta</span><span class="op">)</span></span>
<span>  <span class="va">n_gauss_pixels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">n</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">theta</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co">#* background is uniform</span></span>
<span>  <span class="va">background</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n_unif_pixels</span>, <span class="fl">0</span>, <span class="va">u2_max</span><span class="op">)</span></span>
<span>  <span class="co">#* simulate a number of gaussians randomly between 1 and u1_max</span></span>
<span>  <span class="va">n_gaussians</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="va">u1_max</span><span class="op">)</span></span>
<span>  <span class="co">#* each gaussian has a mean that is uniform between 1 and u2_max</span></span>
<span>  <span class="va">mu_is</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">n_gaussians</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="va">u2_max</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="co">#* each gaussian has a sigma that is half-normal based on sd</span></span>
<span>  <span class="va">sd_is</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">n_gaussians</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">extraDistr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/extraDistr/man/HalfNormal.html" class="external-link">rhnorm</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">sd</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="co">#* assign pixels randomly to gaussians</span></span>
<span>  <span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">n_gaussians</span><span class="op">)</span>, size <span class="op">=</span> <span class="va">n_gauss_pixels</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">px_is</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">n_gaussians</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">index</span> <span class="op">==</span> <span class="va">i</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="co">#* draws n_pixels time from each gaussian</span></span>
<span>  <span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">n_gaussians</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">px_is</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, <span class="va">mu_is</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, <span class="va">sd_is</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co">#* combine data</span></span>
<span>  <span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">d</span>, <span class="va">background</span><span class="op">)</span></span>
<span>  <span class="co">#* make sure no gaussians return data out of bounds</span></span>
<span>  <span class="va">d</span><span class="op">[</span><span class="va">d</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">d</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">abs_max</span><span class="op">)</span></span>
<span>  <span class="va">d</span><span class="op">[</span><span class="va">d</span> <span class="op">&gt;=</span> <span class="va">abs_max</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">d</span> <span class="op">&gt;=</span> <span class="va">abs_max</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">abs_max</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">lastNonZeroBin</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">d</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">d</span><span class="op">[</span><span class="va">d</span><span class="op">$</span><span class="va">value</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="st">"label"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">tubeAngleToDepth</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">theta</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span> <span class="op">*</span> <span class="va">x</span></span>
<span><span class="op">}</span></span>
<span><span class="va">mv_mean</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">d</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html" class="external-link">weighted.mean</a></span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">label</span>, <span class="va">d</span><span class="op">$</span><span class="va">value</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">mv_median</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">d</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">label</span>, <span class="va">d</span><span class="op">$</span><span class="va">value</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">mv_std</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">d</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">label</span>, <span class="va">d</span><span class="op">$</span><span class="va">value</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">sv_from_mv</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">theta</span><span class="op">)</span> <span class="op">{</span> <span class="co"># note this should also return mean/median/std</span></span>
<span>  <span class="va">metaCols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"value|label|trait"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">as.formula</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"value ~ "</span>,</span>
<span>                                     <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">metaCols</span>, collapse <span class="op">=</span> <span class="st">"+"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                   data <span class="op">=</span> <span class="va">df</span>, <span class="va">sum</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"area"</span></span>
<span>  <span class="va">out</span><span class="op">$</span><span class="va">max_pixel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span>, <span class="va">metaCols</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, <span class="va">lastNonZeroBin</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">out</span><span class="op">$</span><span class="va">height</span> <span class="op">&lt;-</span> <span class="fu">tubeAngleToDepth</span><span class="op">(</span><span class="va">out</span><span class="op">$</span><span class="va">max_pixel</span>, <span class="fl">0.35</span><span class="op">)</span></span>
<span>  <span class="va">out</span><span class="op">$</span><span class="va">mean_x_frequencies</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span>, <span class="va">metaCols</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, <span class="va">mv_mean</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">out</span><span class="op">$</span><span class="va">median_x_frequencies</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span>, <span class="va">metaCols</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, <span class="va">mv_median</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">out</span><span class="op">$</span><span class="va">std_x_frequencies</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span>, <span class="va">metaCols</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, <span class="va">mv_std</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The simulated data looks realistic based on limited test data
available at time of writing.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">ex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, <span class="kw">function</span><span class="op">(</span><span class="va">rep</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">n_total_pixels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">100</span>, <span class="fl">3000</span><span class="op">)</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">rRhyzoDist</span><span class="op">(</span>n <span class="op">=</span> <span class="va">n_total_pixels</span><span class="op">)</span></span>
<span>  <span class="va">h</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">x</span>, plot <span class="op">=</span> <span class="cn">FALSE</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5500</span>, <span class="fl">20</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">breaks</span> <span class="op">&lt;-</span> <span class="va">h</span><span class="op">$</span><span class="va">breaks</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">counts</span> <span class="op">&lt;-</span> <span class="va">h</span><span class="op">$</span><span class="va">counts</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    rep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">rep</span><span class="op">)</span>,</span>
<span>    value <span class="op">=</span> <span class="va">counts</span>, label <span class="op">=</span> <span class="va">breaks</span>,</span>
<span>    trait <span class="op">=</span> <span class="st">"x_frequencies"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/pcv.joyplot.html">pcv.joyplot</a></span><span class="op">(</span><span class="va">ex</span>, <span class="st">"x_frequencies"</span>, group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rep"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="roots_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>For the rest of this vignette we will use simulated data. The first
simulated data <code>df</code> assumes that roots can appear and
disappear from the minirhyzotron images over time. The second simulated
data assumes that once a root is seen along the minirhyzotron that it
will stay visible.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n_times</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">parameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n_times</span><span class="op">)</span>,</span>
<span>  n_min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n_times</span><span class="op">)</span>,</span>
<span>  n_max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">2000</span>, <span class="fl">5500</span>, length.out <span class="op">=</span> <span class="va">n_times</span><span class="op">)</span>,</span>
<span>  theta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="va">n_times</span><span class="op">)</span>,</span>
<span>  u1_max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span>, length.out <span class="op">=</span> <span class="va">n_times</span><span class="op">)</span>,</span>
<span>  u2_max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">2000</span>, <span class="fl">5500</span>, length.out <span class="op">=</span> <span class="va">n_times</span><span class="op">)</span>,</span>
<span>  u2_max_noise <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">400</span>, <span class="fl">200</span>, length.out <span class="op">=</span> <span class="va">n_times</span><span class="op">)</span>,</span>
<span>  sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">150</span>, <span class="fl">250</span>, length.out <span class="op">=</span> <span class="va">n_times</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">parameters</span><span class="op">)</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">time</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">pars</span> <span class="op">&lt;-</span> <span class="va">parameters</span><span class="op">[</span><span class="va">parameters</span><span class="op">$</span><span class="va">time</span> <span class="op">==</span> <span class="va">time</span>, <span class="op">]</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="kw">function</span><span class="op">(</span><span class="va">rep</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">n_total_pixels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">pars</span><span class="op">$</span><span class="va">n_min</span>, <span class="va">pars</span><span class="op">$</span><span class="va">n_max</span><span class="op">)</span></span>
<span>    <span class="va">u2_max_iter</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">pars</span><span class="op">$</span><span class="va">u2_max</span>, <span class="va">pars</span><span class="op">$</span><span class="va">u2_max_noise</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">rRhyzoDist</span><span class="op">(</span></span>
<span>      n <span class="op">=</span> <span class="va">n_total_pixels</span>, theta <span class="op">=</span> <span class="va">pars</span><span class="op">$</span><span class="va">theta</span>,</span>
<span>      u1_max <span class="op">=</span> <span class="va">pars</span><span class="op">$</span><span class="va">u1_max</span>,</span>
<span>      u2_max <span class="op">=</span> <span class="va">u2_max_iter</span>, sd <span class="op">=</span> <span class="va">pars</span><span class="op">$</span><span class="va">sd</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="va">h</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">x</span>, plot <span class="op">=</span> <span class="cn">FALSE</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5500</span>, <span class="fl">20</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">breaks</span> <span class="op">&lt;-</span> <span class="va">h</span><span class="op">$</span><span class="va">breaks</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">counts</span> <span class="op">&lt;-</span> <span class="va">h</span><span class="op">$</span><span class="va">counts</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      rep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">rep</span><span class="op">)</span>,</span>
<span>      time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span>,</span>
<span>      value <span class="op">=</span> <span class="va">counts</span>, label <span class="op">=</span> <span class="va">breaks</span>,</span>
<span>      trait <span class="op">=</span> <span class="st">"x_frequencies"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">rep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">rep</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">rep</span><span class="op">)</span><span class="op">)</span>, ordered <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">sv</span> <span class="op">&lt;-</span> <span class="fu">sv_from_mv</span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n_times</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">parameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n_times</span><span class="op">)</span>,</span>
<span>  n_min_new_px <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">50</span>, <span class="va">n_times</span><span class="op">)</span>,</span>
<span>  n_max_new_px <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">2500</span>, length.out <span class="op">=</span> <span class="va">n_times</span><span class="op">)</span>,</span>
<span>  theta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="va">n_times</span><span class="op">)</span>,</span>
<span>  u1_max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span>, length.out <span class="op">=</span> <span class="va">n_times</span><span class="op">)</span>,</span>
<span>  mean_added_depth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">200</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1200</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="va">n_times</span><span class="op">)</span>,</span>
<span>  added_depth_noise <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="va">n_times</span><span class="op">)</span>,</span>
<span>  sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">150</span>, <span class="fl">250</span>, length.out <span class="op">=</span> <span class="va">n_times</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">567</span><span class="op">)</span></span>
<span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="kw">function</span><span class="op">(</span><span class="va">rep</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">dList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">add_area</span> <span class="op">&lt;-</span> <span class="fl">2000</span></span>
<span>  <span class="va">previous_max_depth</span> <span class="op">&lt;-</span> <span class="fl">2000</span></span>
<span>  <span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">time</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">parameters</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">pars</span> <span class="op">&lt;-</span> <span class="va">parameters</span><span class="op">[</span><span class="va">parameters</span><span class="op">$</span><span class="va">time</span> <span class="op">==</span> <span class="va">time</span>, <span class="op">]</span></span>
<span>    <span class="va">n_total_pixels</span> <span class="op">&lt;-</span> <span class="va">add_area</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">pars</span><span class="op">$</span><span class="va">n_min_new_px</span>, <span class="va">pars</span><span class="op">$</span><span class="va">n_max_new_px</span><span class="op">)</span></span>
<span>    <span class="va">max_depth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">previous_max_depth</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">rlnorm</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">pars</span><span class="op">$</span><span class="va">mean_added_depth</span>, <span class="va">pars</span><span class="op">$</span><span class="va">added_depth_noise</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">rRhyzoDist</span><span class="op">(</span></span>
<span>      n <span class="op">=</span> <span class="va">n_total_pixels</span>, theta <span class="op">=</span> <span class="va">pars</span><span class="op">$</span><span class="va">theta</span>,</span>
<span>      u1_max <span class="op">=</span> <span class="va">pars</span><span class="op">$</span><span class="va">u1_max</span>,</span>
<span>      u2_max <span class="op">=</span> <span class="va">max_depth</span>, sd <span class="op">=</span> <span class="va">pars</span><span class="op">$</span><span class="va">sd</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/append.html" class="external-link">append</a></span><span class="op">(</span><span class="va">d</span>, <span class="va">x</span><span class="op">)</span></span>
<span>    <span class="va">h</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">d</span>, plot <span class="op">=</span> <span class="cn">FALSE</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5500</span>, <span class="fl">20</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">breaks</span> <span class="op">&lt;-</span> <span class="va">h</span><span class="op">$</span><span class="va">breaks</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">counts</span> <span class="op">&lt;-</span> <span class="va">h</span><span class="op">$</span><span class="va">counts</span></span>
<span>    <span class="va">dList</span><span class="op">[[</span><span class="va">time</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      rep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">rep</span><span class="op">)</span>,</span>
<span>      time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span>,</span>
<span>      value <span class="op">=</span> <span class="va">counts</span>, label <span class="op">=</span> <span class="va">breaks</span>,</span>
<span>      trait <span class="op">=</span> <span class="st">"x_frequencies"</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="va">add_area</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>    <span class="va">previous_max_depth</span> <span class="op">&lt;-</span> <span class="va">max_depth</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">dList</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df2</span><span class="op">$</span><span class="va">rep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">df2</span><span class="op">$</span><span class="va">rep</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">df2</span><span class="op">$</span><span class="va">rep</span><span class="op">)</span><span class="op">)</span>, ordered <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">sv2</span> <span class="op">&lt;-</span> <span class="fu">sv_from_mv</span><span class="op">(</span><span class="va">df2</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="outlier-removal">Outlier Removal<a class="anchor" aria-label="anchor" href="#outlier-removal"></a>
</h2>
</div>
<div class="section level2">
<h2 id="single-value-traits">Single Value Traits<a class="anchor" aria-label="anchor" href="#single-value-traits"></a>
</h2>
<p>If we assume that roots can only enter the minirhyzotron images then
we would expect a positive trend over time for total root area.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">sv</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">area</span>, group <span class="op">=</span> <span class="va">rep</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Sampling Time"</span>, y <span class="op">=</span> <span class="st">"Area (px)"</span>, title <span class="op">=</span> <span class="st">"Assuming roots can leave the image"</span><span class="op">)</span></span></code></pre></div>
<p><img src="roots_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">sv2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">area</span>, group <span class="op">=</span> <span class="va">rep</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Sampling Time"</span>, y <span class="op">=</span> <span class="st">"Area (px)"</span>, title <span class="op">=</span> <span class="st">"Assuming roots can only enter the image"</span><span class="op">)</span></span></code></pre></div>
<p><img src="roots_files/figure-html/unnamed-chunk-5-2.png" width="700"></p>
<p>It would also make sense that the mean of the distribution would move
deeper over time as roots have time to grow. This is likely to be true
regardless of whether roots can leave the image.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">sv</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">mean_x_frequencies</span>, group <span class="op">=</span> <span class="va">rep</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Sampling Time"</span>, y <span class="op">=</span> <span class="st">"Mean Depth"</span>, title <span class="op">=</span> <span class="st">"Assuming roots can leave the image"</span><span class="op">)</span></span></code></pre></div>
<p><img src="roots_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">sv2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">mean_x_frequencies</span>, group <span class="op">=</span> <span class="va">rep</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Sampling Time"</span>, y <span class="op">=</span> <span class="st">"Mean Depth"</span>, title <span class="op">=</span> <span class="st">"Assuming roots can only enter the image"</span><span class="op">)</span></span></code></pre></div>
<p><img src="roots_files/figure-html/unnamed-chunk-6-2.png" width="700"></p>
<p>The same should be true for the median, although being more robust to
outliers it may move more slowly.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">sv</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">median_x_frequencies</span>, group <span class="op">=</span> <span class="va">rep</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Sampling Time"</span>, y <span class="op">=</span> <span class="st">"Median Depth"</span>, title <span class="op">=</span> <span class="st">"Assuming roots can leave the image"</span><span class="op">)</span></span></code></pre></div>
<p><img src="roots_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">sv2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">median_x_frequencies</span>, group <span class="op">=</span> <span class="va">rep</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Sampling Time"</span>, y <span class="op">=</span> <span class="st">"Median Depth"</span>, title <span class="op">=</span> <span class="st">"Assuming roots can only enter the image"</span><span class="op">)</span></span></code></pre></div>
<p><img src="roots_files/figure-html/unnamed-chunk-7-2.png" width="700"></p>
<p>Finally, depth (height as returned by <code>PlantCV</code>) should
increase in both datasets over time but should be strictly monotone if
roots can only enter the images.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">sv</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">height</span>, group <span class="op">=</span> <span class="va">rep</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Sampling Time"</span>, y <span class="op">=</span> <span class="st">"Max Depth"</span>, title <span class="op">=</span> <span class="st">"Assuming roots can leave the image"</span><span class="op">)</span></span></code></pre></div>
<p><img src="roots_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">sv2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">height</span>, group <span class="op">=</span> <span class="va">rep</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Sampling Time"</span>, y <span class="op">=</span> <span class="st">"Max Depth"</span>, title <span class="op">=</span> <span class="st">"Assuming roots can only enter the image"</span><span class="op">)</span></span></code></pre></div>
<p><img src="roots_files/figure-html/unnamed-chunk-8-2.png" width="700"></p>
<div class="section level3">
<h3 id="statistical-analysis">Statistical Analysis<a class="anchor" aria-label="anchor" href="#statistical-analysis"></a>
</h3>
<p>These data are likely to be noisier than above ground phenotypes but
the same general methods should be applicable. Here we will show a
simple example of longitudinal modeling using <code>growthSS</code> and
a pairwise comparison via <code>conjugate</code> but any methods in
other vignettes may be broadly reasonable.</p>
<div class="section level4">
<h4 id="longitudinal-modeling">Longitudinal Modeling<a class="anchor" aria-label="anchor" href="#longitudinal-modeling"></a>
</h4>
<p>For the purposes of this example we combine the two datasets as
though each is from one genotype where the roots exhibit different
behavior in being able to leave the image vs not being able to leave the
image and model the root area over time.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sv</span><span class="op">$</span><span class="va">geno</span> <span class="op">&lt;-</span> <span class="st">"a"</span></span>
<span><span class="va">sv2</span><span class="op">$</span><span class="va">geno</span> <span class="op">&lt;-</span> <span class="st">"b"</span></span>
<span><span class="va">ex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">sv</span>, <span class="va">sv2</span><span class="op">)</span></span>
<span><span class="va">ex</span><span class="op">$</span><span class="va">time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">ex</span><span class="op">$</span><span class="va">time</span><span class="op">)</span></span></code></pre></div>
<p>We fit a (perhaps overly) simple linear model to this data using the
<code>nls</code> backend. Other options include quantile modeling
(<code>type = "nlrq"</code>), frequentist mixed effect modeling
(<code>type = "nlme"</code>), General Additive modeling
(<code>type = "mgcv"</code>), and Bayesian hierarchical modeling
(<code>type = "brms"</code>).</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ss</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/growthSS.html">growthSS</a></span><span class="op">(</span><span class="st">"int_linear"</span>, <span class="va">area</span> <span class="op">~</span> <span class="va">time</span> <span class="op">|</span> <span class="va">rep</span> <span class="op">/</span> <span class="va">geno</span>, df <span class="op">=</span> <span class="va">ex</span>, type <span class="op">=</span> <span class="st">"nls"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Individual is not used with type = 'nls'.</span></span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitGrowth.html">fitGrowth</a></span><span class="op">(</span><span class="va">ss</span><span class="op">)</span></span></code></pre></div>
<p>Any models fit by <code>fitGrowth</code> can be visualized using
<code>growthPlot</code>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/growthPlot.html">growthPlot</a></span><span class="op">(</span><span class="va">m1</span>, form <span class="op">=</span> <span class="va">ss</span><span class="op">$</span><span class="va">pcvrForm</span>, df <span class="op">=</span> <span class="va">ss</span><span class="op">$</span><span class="va">df</span><span class="op">)</span></span></code></pre></div>
<p><img src="roots_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<p>And non-<code>brms</code> models can be tested using
<code>testGrowth</code>. Note that <code><a href="https://paul-buerkner.github.io/brms/reference/hypothesis.brmsfit.html" class="external-link">brms::hypothesis</a></code> is a
more flexible version of the third example of <code>testGrowth</code>
below.</p>
<p>We might test that the intercept (amount of roots visible at the
first timepoint) is different:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/testGrowth.html">testGrowth</a></span><span class="op">(</span><span class="va">ss</span>, <span class="va">m1</span>, test <span class="op">=</span> <span class="st">"I"</span><span class="op">)</span><span class="op">$</span><span class="va">anova</span></span></code></pre></div>
<pre><code><span><span class="co">## Analysis of Variance Table</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Model 1: area ~ I + A[geno] * time</span></span>
<span><span class="co">## Model 2: area ~ I[geno] + A[geno] * time</span></span>
<span><span class="co">##   Res.Df Res.Sum Sq Df  Sum Sq F value   Pr(&gt;F)   </span></span>
<span><span class="co">## 1     97   81858044                               </span></span>
<span><span class="co">## 2     96   76177689  1 5680355  7.1584 0.008773 **</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre>
<p>That the effect of time is different:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/testGrowth.html">testGrowth</a></span><span class="op">(</span><span class="va">ss</span>, <span class="va">m1</span>, test <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span><span class="op">$</span><span class="va">anova</span></span></code></pre></div>
<pre><code><span><span class="co">## Analysis of Variance Table</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Model 1: area ~ I[geno] + A * time</span></span>
<span><span class="co">## Model 2: area ~ I[geno] + A[geno] * time</span></span>
<span><span class="co">##   Res.Df Res.Sum Sq Df  Sum Sq F value  Pr(&gt;F)   </span></span>
<span><span class="co">## 1     97   83399590                              </span></span>
<span><span class="co">## 2     96   76177689  1 7221900  9.1011 0.00327 **</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre>
<p>Or more specific hypotheses on any coefficients such as the slope for
the first group being 10% higher than that of the second group (to
clarify groups you can always check the data returned by
<code>growthSS</code>):</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">ss</span><span class="op">$</span><span class="va">df</span><span class="op">$</span><span class="va">geno</span>, <span class="va">ss</span><span class="op">$</span><span class="va">df</span><span class="op">$</span><span class="va">geno_numericLabel</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    </span></span>
<span><span class="co">##      1  2</span></span>
<span><span class="co">##   a 50  0</span></span>
<span><span class="co">##   b  0 50</span></span></code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/testGrowth.html">testGrowth</a></span><span class="op">(</span><span class="va">ss</span>, <span class="va">m1</span>, test <span class="op">=</span> <span class="st">"A1*1.1 - A2"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##          Form Estimate       SE  t-value    p-value</span></span>
<span><span class="co">## 1 A1*1.1 - A2 -318.448 132.4264 2.404718 0.01810283</span></span></code></pre>
<p>If you have a more nuanced hypothesis or want to model
heteroskedasticity and autocorrelation then other backends as detailed
in the <a href="https://github.com/danforthcenter/pcvr/tree/main/tutorials/pcvrTutorial_intermediateGrowthModeling" class="external-link">intermediate
growth modeling</a> and <a href="https://github.com/danforthcenter/pcvr/tree/main/tutorials/pcvrTutorial_advancedGrowthModeling" class="external-link">advanced
growth modeling</a> tutorials may be of use.</p>
</div>
<div class="section level4">
<h4 id="pairwise-comparisons">Pairwise Comparisons<a class="anchor" aria-label="anchor" href="#pairwise-comparisons"></a>
</h4>
<p>For non-longitudinal data/hypotheses any standard tests may be
useful. Here we’ll only show <code>conjugate</code> since it is a
departure from the norm.</p>
<p>The <code>conjugate</code> function makes pairwise Bayesian
comparisons using distributions for which there are conjugate prior
distributions that can be easily updated with observed data. This allows
for more direct hypothesis testing and Region of Practical Equivalence
(ROPE) testing.</p>
<p>Here we might use <code>conjugate</code> to compare to compare area
on the last day between our two “genotypes”. In this example we’ll use
the “T” distribution to run a Bayesian analog to a T-test.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s1</span> <span class="op">&lt;-</span> <span class="va">ex</span><span class="op">[</span><span class="va">ex</span><span class="op">$</span><span class="va">geno</span> <span class="op">==</span> <span class="st">"a"</span> <span class="op">&amp;</span> <span class="va">ex</span><span class="op">$</span><span class="va">time</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">ex</span><span class="op">$</span><span class="va">time</span><span class="op">)</span>, <span class="st">"area"</span><span class="op">]</span></span>
<span><span class="va">s2</span> <span class="op">&lt;-</span> <span class="va">ex</span><span class="op">[</span><span class="va">ex</span><span class="op">$</span><span class="va">geno</span> <span class="op">==</span> <span class="st">"b"</span> <span class="op">&amp;</span> <span class="va">ex</span><span class="op">$</span><span class="va">time</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">ex</span><span class="op">$</span><span class="va">time</span><span class="op">)</span>, <span class="st">"area"</span><span class="op">]</span></span>
<span></span>
<span><span class="va">conj_ex</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/conjugate.html">conjugate</a></span><span class="op">(</span></span>
<span>  <span class="va">s1</span>, <span class="va">s2</span>, <span class="co"># specify data, here two samples</span></span>
<span>  method <span class="op">=</span> <span class="st">"t"</span>, <span class="co"># use the "T" distribution</span></span>
<span>  priors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mu <span class="op">=</span> <span class="fl">3000</span>, n <span class="op">=</span> <span class="fl">1</span>, s2 <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span>, <span class="co"># prior distribution, here it is the same for both samples</span></span>
<span>  plot <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># return a plot</span></span>
<span>  rope_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">500</span>, <span class="fl">500</span><span class="op">)</span>, <span class="co"># differences of &lt;500 pixels deemed not meaningful</span></span>
<span>  rope_ci <span class="op">=</span> <span class="fl">0.89</span>, cred.int.level <span class="op">=</span> <span class="fl">0.89</span>, <span class="co"># default credible interval lengths</span></span>
<span>  hypothesis <span class="op">=</span> <span class="st">"equal"</span>, <span class="co"># hypothesis to test</span></span>
<span>  support <span class="op">=</span> <span class="cn">NULL</span> <span class="co"># optionally you can provide support, this is generally unnecessary.</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The <code>conjugate</code> output includes a summary, the posterior
distributions in the same format as the priors were supplied, and
optionally a plot.</p>
<p>The summary contains the HDE (highest density estimate) of each
group’s posterior distribution, the HDI (highest density interval) of
each group’s posterior distribution, the hypothesis that was tested, the
posterior probability of that hypothesis, the HDE/HDI for the mean
difference (if rope_range was specified), and the probability of the
mean difference being within the rope_range.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">conj_ex</span><span class="op">$</span><span class="va">summary</span></span></code></pre></div>
<pre><code><span><span class="co">##      HDE_1 HDI_1_low HDI_1_high    HDE_2 HDI_2_low HDI_2_high   hyp  post.prob</span></span>
<span><span class="co">## 1 3614.727   2927.25   4302.205 6153.182  5385.898   6920.466 equal 0.01202173</span></span>
<span><span class="co">##    HDE_rope HDI_rope_low HDI_rope_high rope_prob</span></span>
<span><span class="co">## 1 -2536.119    -3578.364     -1463.956         0</span></span></code></pre>
<p>The posterior is returned as a list with the same elements as the
prior. This allows for Bayesian updating if you wish to do so.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">conj_ex</span><span class="op">$</span><span class="va">posterior</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      mu       n  s2     </span></span>
<span><span class="co">## [1,] 3614.727 11 1690217</span></span>
<span><span class="co">## [2,] 6153.182 11 2105416</span></span></code></pre>
<p>The plot includes information from the summary graphically as a
patchwork of 2 ggplots if rope_range was specified or is a single ggplot
otherwise.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">conj_ex</span><span class="op">$</span><span class="va">plot</span></span></code></pre></div>
<p><img src="roots_files/figure-html/unnamed-chunk-18-1.png" width="700"></p>
<p>Here we would conclude that the distributions are different since the
probability that they are the same is roughly 1% and that the mean
difference is biologically meaningful since the HDI of the mean
difference falls entirely outside of our rope_range.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="multi-value-traits">Multi Value Traits<a class="anchor" aria-label="anchor" href="#multi-value-traits"></a>
</h2>
<p>The multi value traits returned by <code>analyze_distribution</code>
will often be more difficult to analyze than standard multi value traits
that describe spectral wavelengths or indices. The
<code>conjugate</code> function can use MV traits by specifying
matrices/data.frames for s1 and s2, but it will be very rare that a
minirhyzotron image’s distribution will follow an easily parameterized
pdf.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/pcv.joyplot.html">pcv.joyplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="st">"x_frequencies"</span>, group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rep"</span>, <span class="st">"time"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="roots_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
<p>Theoretically we could consider this as a mixture of uniform and
gaussian distributions. A mixture of conjugate priors yields a mixture
of conjugate posteriors, but this is out of the current scope of
<code>conjugate</code>. Likewise, the complexity of a non-conjugate
mixture model applied to this data does not seem warranted.</p>
<p>The other general option in <code>pcvr</code> to analyze multi-value
traits is Earth-Mover’s Distance (EMD), which is a distance metric to
classify how much “work” it would take to turn one histogram into
another. This may be useful for minirhyzotron data depending on your
hypothesis.</p>
<p>Here we will show an ad-hoc option to compare the number of “peaks”
in the data and an example of using EMD.</p>
<div class="section level3">
<h3 id="numbers-of-peaks">Numbers of Peaks<a class="anchor" aria-label="anchor" href="#numbers-of-peaks"></a>
</h3>
<p>To compare the number of peaks we need a way to identify a peak. Here
we do this with a quick function that finds intervals of counts above
some cutoff for at least some duration.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">getPeaks</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">d</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">intensity</span> <span class="op">=</span> <span class="fl">20</span>, <span class="va">duration</span> <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">binwidth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">label</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">binwidth</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"label column should have constant bin size"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">d</span><span class="op">[</span><span class="va">d</span><span class="op">$</span><span class="va">value</span> <span class="op">&gt;=</span> <span class="va">intensity</span>, <span class="st">"label"</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rle.html" class="external-link">rle</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">labels</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">peaks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">r</span><span class="op">$</span><span class="va">lengths</span><span class="op">[</span><span class="va">r</span><span class="op">$</span><span class="va">values</span> <span class="op">==</span> <span class="va">binwidth</span><span class="op">]</span> <span class="op">&gt;=</span> <span class="va">duration</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">peaks</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rep"</span>, <span class="st">"time"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">peak_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>peaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">d</span>, <span class="va">getPeaks</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">peak_df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">peak_df</span><span class="op">$</span><span class="va">rep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">nm</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="va">nm</span>, <span class="st">"[.]"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">peak_df</span><span class="op">$</span><span class="va">time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">nm</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="va">nm</span>, <span class="st">"[.]"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s1</span> <span class="op">&lt;-</span> <span class="va">peak_df</span><span class="op">[</span><span class="va">peak_df</span><span class="op">$</span><span class="va">time</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">peak_df</span><span class="op">$</span><span class="va">time</span><span class="op">)</span>, <span class="st">"peaks"</span><span class="op">]</span></span>
<span><span class="va">s2</span> <span class="op">&lt;-</span> <span class="va">peak_df</span><span class="op">[</span><span class="va">peak_df</span><span class="op">$</span><span class="va">time</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">peak_df</span><span class="op">$</span><span class="va">time</span><span class="op">)</span>, <span class="st">"peaks"</span><span class="op">]</span></span>
<span></span>
<span><span class="va">conj_ex2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/conjugate.html">conjugate</a></span><span class="op">(</span></span>
<span>  <span class="va">s1</span>, <span class="va">s2</span>, <span class="co"># specify data, here two samples</span></span>
<span>  method <span class="op">=</span> <span class="st">"poisson"</span>, <span class="co"># use the Poisson distribution</span></span>
<span>  priors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span>, b <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>, <span class="co"># prior distributions for gamma on lambda</span></span>
<span>  plot <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># return a plot</span></span>
<span>  rope_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, <span class="co"># differences of &lt;500 pixels deemed not meaningful</span></span>
<span>  rope_ci <span class="op">=</span> <span class="fl">0.89</span>, cred.int.level <span class="op">=</span> <span class="fl">0.89</span>, <span class="co"># default credible interval lengths</span></span>
<span>  hypothesis <span class="op">=</span> <span class="st">"equal"</span>, <span class="co"># hypothesis to test</span></span>
<span>  support <span class="op">=</span> <span class="cn">NULL</span> <span class="co"># optionally you can provide support, this is generally unnecessary.</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">conj_ex2</span><span class="op">$</span><span class="va">summary</span></span></code></pre></div>
<pre><code><span><span class="co">##     HDE_1 HDI_1_low HDI_1_high    HDE_2 HDI_2_low HDI_2_high   hyp post.prob</span></span>
<span><span class="co">## 1 1.47619  1.006947   2.234277 2.904762  2.198332   3.900187 equal 0.1187409</span></span>
<span><span class="co">##    HDE_rope HDI_rope_low HDI_rope_high rope_prob</span></span>
<span><span class="co">## 1 -1.421496     -2.42047    -0.3689384 0.2331199</span></span></code></pre>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">conj_ex2</span><span class="op">$</span><span class="va">posterior</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      a    b   </span></span>
<span><span class="co">## [1,] 16.5 10.5</span></span>
<span><span class="co">## [2,] 31.5 10.5</span></span></code></pre>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">conj_ex2</span><span class="op">$</span><span class="va">plot</span></span></code></pre></div>
<p><img src="roots_files/figure-html/unnamed-chunk-25-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="emd">EMD<a class="anchor" aria-label="anchor" href="#emd"></a>
</h3>
<p>Earth Mover’s Distance measures how much work it takes to turn one
histogram into another. Since multi- value traits are exported from
<code>PlantCV</code> as histograms this can be useful for color or
distribution analysis. In the following examples we make pairwise
comparisons of all our rows and return a long dataframe of those
distances. EMD can be computationally heavy with very large datasets
since all the pairwise distances have to be calculated. The
<code>mvAg</code> function may be useful if you need to summarize your
data to make EMD faster. If you are only interested in a change of the
mean then this is probably not the best way to use your data, but it is
a reasonable option for comparing whether groups are more or less
self-similar than other groups.</p>
<p>Here is a fast example of EMD. In this simulated data we have five
generating distributions. Normal, Log Normal, Bimodal, Trimodal, and
Uniform. We could use some gaussian mixtures to characterize the
multi-modal histograms but that will get clunky for comparing to the
unimodal or uniform distributions. The <code>conjugate</code> function
would not work here since these distributions do not share a common
parameterization. Instead, we can use EMD.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="va">simFreqs</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">vec</span>, <span class="va">group</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">s1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">vec</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">181</span>, <span class="fl">1</span><span class="op">)</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">counts</span></span>
<span>  <span class="va">s1d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">s1</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">s1d</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"group"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"sim_"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">180</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">s1d</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">sim_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">simFreqs</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">50</span>, <span class="fl">10</span><span class="op">)</span>, group <span class="op">=</span> <span class="st">"normal"</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">simFreqs</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">rlnorm</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">30</span><span class="op">)</span>, <span class="fl">0.25</span><span class="op">)</span>, group <span class="op">=</span> <span class="st">"lognormal"</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">simFreqs</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">rlnorm</a></span><span class="op">(</span><span class="fl">125</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">15</span><span class="op">)</span>, <span class="fl">0.25</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">75</span>, <span class="fl">75</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span>, group <span class="op">=</span> <span class="st">"bimodal"</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">simFreqs</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">rlnorm</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">15</span><span class="op">)</span>, <span class="fl">0.25</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">50</span>, <span class="fl">5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">90</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span>, group <span class="op">=</span> <span class="st">"trimodal"</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">simFreqs</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">1</span>, <span class="fl">180</span><span class="op">)</span>, group <span class="op">=</span> <span class="st">"uniform"</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim_df_long</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/melt.data.table.html" class="external-link">melt</a></span><span class="op">(</span><span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">sim_df</span><span class="op">)</span>, id.vars <span class="op">=</span> <span class="st">"group"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sim_df_long</span><span class="op">$</span><span class="va">bin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"sim_"</span>, <span class="st">""</span>, <span class="va">sim_df_long</span><span class="op">$</span><span class="va">variable</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">sim_df_long</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bin</span>, y <span class="op">=</span> <span class="va">value</span>, fill <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"identity"</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/pcv_theme.html">pcv_theme</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">group</span><span class="op">)</span></span></code></pre></div>
<p><img src="roots_files/figure-html/unnamed-chunk-26-1.png" width="700"></p>
<p>Our plots show very different distributions, so we get EMD between
our images and see that we do have some trends shown in the resulting
heatmap.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_emd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pcv.emd.html">pcv.emd</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">sim_df</span>, cols <span class="op">=</span> <span class="st">"sim_"</span>, reorder <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"group"</span><span class="op">)</span>,</span>
<span>  mat <span class="op">=</span> <span class="cn">FALSE</span>, plot <span class="op">=</span> <span class="cn">TRUE</span>, parallel <span class="op">=</span> <span class="fl">1</span>, raiseError <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Estimated time of calculation is roughly 3.1 seconds using 1 cores in parallel.</span></span></code></pre>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_emd</span><span class="op">$</span><span class="va">plot</span></span></code></pre></div>
<p><img src="roots_files/figure-html/unnamed-chunk-27-1.png" width="700"></p>
<p>Arranging these distances into a network of dissimilarities shows the
different distributions clustering well.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pcv.net.html">pcv.net</a></span><span class="op">(</span><span class="va">sim_emd</span><span class="op">$</span><span class="va">data</span>, filter <span class="op">=</span> <span class="st">"0.5"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/net.plot.html">net.plot</a></span><span class="op">(</span><span class="va">n</span>, fill <span class="op">=</span> <span class="st">"group"</span><span class="op">)</span></span></code></pre></div>
<p><img src="roots_files/figure-html/unnamed-chunk-28-1.png" width="700"></p>
<p>Using our simulated mini-rhyzotron data we can go through the same
steps. Here we will show this with both simulated datasets (roots
leaving the image and roots being stuck in the image once observed).</p>
<p>First we check our distributions via joyplot.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/pcv.joyplot.html">pcv.joyplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="st">"x_frequencies"</span>, group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rep"</span>, <span class="st">"time"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="roots_files/figure-html/unnamed-chunk-29-1.png" width="700"></p>
<p>We calculate EMD between our observations. Note here we have long
input data as opposed to wide in the previous example.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df1_emd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pcv.emd.html">pcv.emd</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">df</span>, cols <span class="op">=</span> <span class="st">"x_frequencies"</span>, reorder <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rep"</span>, <span class="st">"time"</span><span class="op">)</span>,</span>
<span>  id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rep"</span>, <span class="st">"time"</span><span class="op">)</span>,</span>
<span>  mat <span class="op">=</span> <span class="cn">FALSE</span>, plot <span class="op">=</span> <span class="cn">TRUE</span>, parallel <span class="op">=</span> <span class="fl">1</span>, raiseError <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>And we arrange the distances as a network of dissimilarities. Here we
are filtering for only those edges that are above the 75th percentile in
strength and we see a pretty clear temporal clustering.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pcv.net.html">pcv.net</a></span><span class="op">(</span><span class="va">df1_emd</span><span class="op">$</span><span class="va">data</span>, filter <span class="op">=</span> <span class="st">"0.75"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/net.plot.html">net.plot</a></span><span class="op">(</span><span class="va">n</span>, fill <span class="op">=</span> <span class="st">"time"</span><span class="op">)</span></span></code></pre></div>
<p><img src="roots_files/figure-html/unnamed-chunk-31-1.png" width="700"></p>
<p>With our dataset that assumes roots cannot leave the image once
observed we get similar results.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/pcv.joyplot.html">pcv.joyplot</a></span><span class="op">(</span><span class="va">df2</span>, <span class="st">"x_frequencies"</span>, group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rep"</span>, <span class="st">"time"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="roots_files/figure-html/unnamed-chunk-32-1.png" width="700"></p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df2_emd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pcv.emd.html">pcv.emd</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">df2</span>, cols <span class="op">=</span> <span class="st">"x_frequencies"</span>, reorder <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rep"</span>, <span class="st">"time"</span><span class="op">)</span>,</span>
<span>  id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rep"</span>, <span class="st">"time"</span><span class="op">)</span>,</span>
<span>  mat <span class="op">=</span> <span class="cn">FALSE</span>, plot <span class="op">=</span> <span class="cn">TRUE</span>, parallel <span class="op">=</span> <span class="fl">1</span>, raiseError <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">n2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pcv.net.html">pcv.net</a></span><span class="op">(</span><span class="va">df2_emd</span><span class="op">$</span><span class="va">data</span>, filter <span class="op">=</span> <span class="st">"0.75"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/net.plot.html">net.plot</a></span><span class="op">(</span><span class="va">n2</span>, fill <span class="op">=</span> <span class="st">"time"</span><span class="op">)</span></span></code></pre></div>
<p><img src="roots_files/figure-html/unnamed-chunk-32-2.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>Root imaging raises several potentially interesting problems around
having new phenotypes to consider and noisy data before and after
segmentation. It is always important to consider the generating process
for your data but that may be especially true where it comes to
minirhyzotron image data. Hopefully this vignette helps provide some
examples for how these data can be used, but if you have ideas or
questions please raise them in the <code>pcvr</code> <a href="https://github.com/danforthcenter/pcvr" class="external-link">github issues</a> or in
the <code>help-datascience</code> slack channel for Danforth Center
users.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Maintained by Josh Sumner <br> Developed in DDPSC Datascience Core Facility <br> Logo design by <a href="https://twitter.com/Kerri_Gilbert" class="external-link">Kerri Gilbert</a></p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
