---
title: "Water data"
subtitle: "pcvr v1.1.1.1"
author: Josh Sumner
output: html_document
editor: source
---

```{r}
library(ggplot2)
library(patchwork)
library(devtools)
load_all("~/pcvr") # CHANGE FOR RELEASE
```


## Outline

- why you'd work with water data
- overview of WUE vs pWUE
- information from the ditech presentation (vpd, etc)
- reading in water data
- water diagnostic plots
  - annotating water diagnostic plots
- Pwue
  - rate
  - abs
  - normalized_daily_transpiration
- plug for hierarchical models

## Why water data?

- Water is fundamental to plant life.
- Plants need water to survive.
- Water is a critical farming resource.
- Climate change affects water supply.

## How does a plant use water?

The "Pull Theory" says that water moves through a plant based on pressure differentials.

- 1: Water enters the plant through roots (note many root traits will affect how this happens).
- 2: Water travels through the xylem (channels along plant tissue).
- 3: Water is prepared for stomatal exit (stomata are small pores mostly along the underside of leaves).
- 4: Water *Transpires* to the leaf surface (similar to us sweating).
-- Water that has transpired to the surface will then evaporate, but the rate of evaporation depends on *Boundary Layer Conductance*.
--- Boundary Layer Conductance (BLC) is a measure of how easily gas exchange happens in a small "boundary layer" around the plant.
--- BLC is changed by qualities such as leaf shape and angle (think about facing the sun or standing at an angle) as well as phenotypes we don't generally measure with image data such as trichome (small hairs on leaf surface) length and density (think trapping humidity in your hair).
--- Evaporation is also dependent on environmental conditions such as ambient temperature, wind speed, atmospheric pressure, light intensity, soil type, soil moisture content, etc.
--- *Vapor Pressure Deficit* (VPD) is another important quantity for evaporation and transpiration. VPD is the difference in the amount of water in the air vs the amount of water the air can hold at the given temperature. Since warmer air can hold more water VPD is higher on a hot day even when relative humidity is held constant, this is an important consideration for experimental design particularly in growth chambers.

Transpiration has to be balanced carefully by a plant since the plant is using water both to build new biomass and to cool off.

There can be secondary consequences to increased transpiration depending on the experimental design and what you are measuring, for instance:
- Higher transpiration means higher Transport of nutrients into the plant from soil.
- Higher transpiration means faster transport of metabolites in the plant.
- Higher transpiration reduces leaf temperature.
- Higher transpiration allows for easier pathogen infection via open stomata.
- Water pH and salt content affect uptake and the plant cells.

## Measuring water use

Measuring water use can be difficult. Broadly we can either measure water vapor released from the plant or measure the amount of water removed from the soil. Measuring gasses tends to be more difficult, so we tend to focus on weight changes to the pot.

Measuring water use via weight changes in a planted pot has some caveats. First, we have to assume that there is a period of neglibible transpiration (we tend to assume that when lights are off and stomata are closed at night no water is transpired). Second, we have to assume that the only way that water is lost from the pot is via transpiration through the plant.

In the following plot we look at a simulated plant's watering data. This plant has been weighed for 5 days, with water added in the middle of the night and plants weighed shortly before watering and when lights come on in the morning. The differences between adjacent waterings are what we will use later on to calculate transpiration and *water use efficiency* (WUE).

```{r, eval = TRUE, echo = FALSE}
set.seed(123)
days <- 5
n_plants <- 1
ex <- data.frame(id = paste0("Plant ", rep(seq_len(n_plants), each = days * 2)),
           DAS = rep(c(1:days - 0.5, 1:days + 0.1), times = n_plants),
           variable = rep(c("weight_after_watering", "weight_before_watering"), each = days),
           value = unlist(lapply(seq_len(n_plants), function(i) {
             x <- sort(runif(days, 50, 100))
             c(x, x - runif(days, 10, 20))
           })))
daybars <- data.frame(ymin = 0, ymax = 1.1 * max(ex$value),
           xmin = seq(0, days, 0.5),
           xmax = seq(0.5, days + 0.5, 0.5),
           day_or_night = rep(c("lights off", "lights on"), length.out = 11))

watering_1 <- data.frame(id = ex[1, "id"],
                   water = ex[2, "value"],
                   start = mean(c(ex[2, "value"], ex[c(days + 1), "value"])),
                   DAS = ex[c(days + 1), "DAS"] + 0.75)

watering_2 <- data.frame(id = ex[1, "id"],
                   water = ex[3, "value"],
                   start = mean(c(ex[3, "value"], ex[c(days + 2), "value"])),
                   DAS = ex[c(days + 2), "DAS"] + 0.175)

ggplot(ex, aes(x = DAS, y = value, color = variable)) +
  facet_wrap(~id) +
  geom_rect(data = daybars, aes(xmin = xmin, ymin = ymin, xmax = xmax, ymax = ymax,
                                fill = day_or_night),
            inherit.aes = FALSE, alpha = 0.5) +
  scale_fill_manual(values = c("gray80", "antiquewhite")) +
  scale_x_continuous(breaks = seq(1, 6, 1)) +
  coord_cartesian(ylim = c(0.9 * round(min(ex$value)), 1.1 * round(max(ex$value))),
                  expand = FALSE) +
  geom_line(color = "black") +
  geom_point() +
  geom_segment(data = watering_1, aes(x = DAS, xend = DAS, y = start, yend = water),
               linetype = 5, color = "gray40", inherit.aes = FALSE) +
  geom_label(data = watering_1, aes(x = DAS, y = water), hjust = 0.75, vjust = -0.25,
             label = "Water lost\nduring day", inherit.aes = FALSE)+
  geom_segment(data = watering_2, aes(x = DAS, xend = DAS, y = start, yend = water),
               linetype = 5, color = "gray40", inherit.aes = FALSE) +
  geom_label(data = watering_2, aes(x = DAS, y = water), hjust = 0.5, vjust = -0.25,
             label = "Water added\nat night", inherit.aes = FALSE) +
  annotate("segment", x = seq(1.25, days, 1), xend = seq(1.25, days, 1),
           y = round(min(ex$value))- 4,
           yend = round(min(ex$value)), linetype = 3,  color = "navy") +
  annotate("label", x = days - 1, y = round(min(ex$value)), label = "watering times",
           vjust = -0.25, hjust = -0.25) +
  labs(x = "Days After Start", y = "Pot Weight (g)",
       fill = "Light", color = "Weight") +
  pcv_theme() +
  theme(legend.position = "bottom")
```

## Calculating Transpiration

```{r, eval = TRUE, echo = FALSE}
exw <- ex
exw$DAS <- rep(seq(1, days, 1), times = 2) - 0.2
exw <- reshape2::dcast(exw, DAS + id ~ variable, value.var = "value")
exw$diff <- exw$weight_after_watering - exw$weight_before_watering

ggplot(ex, aes(x = DAS, y = value, color = variable)) +
  facet_wrap(~id) +
  geom_rect(data = daybars, aes(xmin = xmin, ymin = ymin, xmax = xmax, ymax = ymax,
                                fill = day_or_night),
            inherit.aes = FALSE, alpha = 0.5) +
  scale_fill_manual(values = c("gray80", "antiquewhite")) +
  scale_x_continuous(breaks = seq(1, 6, 1)) +
  coord_cartesian(ylim = c(0.9 * round(min(ex$value)), 1.1 * round(max(ex$value))),
                  expand = FALSE) +
  geom_line(color = "black") +
  geom_point() +
  geom_text(data = exw, aes(x = DAS, y = weight_after_watering, label = round(diff, 1)), 
            inherit.aes = FALSE) +
  labs(x = "Days After Start", y = "Pot Weight (g)",
       fill = "Light", color = "Weight", title = "Amount of water transpired per day") +
  pcv_theme() +
  theme(legend.position = "bottom")
```

Transpiration doesn't generally give us enough information to use until it is normalized to biomass. We generally expect larger plants to transpire more since they have more area to draw water through and typically have more extensive root structures. Instead of using daily transpiration we often want to talk about *Normalized Transpiration* or *Water Use Efficiency*.

**Note:** the values above are positive because we are framing the question as "the amount of water transpired", so despite the slope of the line (showing mass in the pot) going down we have positive numbers.

To normalize transpiration we need a measure or a proxy of plant biomass.

```{r, eval = TRUE, echo = FALSE}
set.seed(345)
exw$biomass <- sort(runif(days, 5, 15))

p1 <- ggplot(exw, aes(x = DAS, y = biomass)) +
  facet_wrap(~id) +
  geom_line(color = "black") +
  geom_point() +
  labs(x = "Days After Start", y = "Plant Biomass (g)",
       fill = "Light", color = "Weight", title = "Plant Biomass (g)") +
  pcv_theme() +
  theme(legend.position = "bottom")

p2 <- ggplot(ex, aes(x = DAS, y = value, color = variable)) +
  facet_wrap(~id) +
  geom_rect(data = daybars, aes(xmin = xmin, ymin = ymin, xmax = xmax, ymax = ymax,
                                fill = day_or_night),
            inherit.aes = FALSE, alpha = 0.5, show.legend = FALSE) +
  scale_fill_manual(values = c("gray80", "antiquewhite")) +
  scale_x_continuous(breaks = seq(1, 6, 1)) +
  coord_cartesian(ylim = c(0.9 * round(min(ex$value)), 1.1 * round(max(ex$value))),
                  expand = FALSE) +
  geom_line(color = "black") +
  geom_point() +
  geom_text(data = exw, aes(x = DAS + 0.1, y = weight_after_watering,
                            label = paste0(round(diff, 1), "/", round(biomass, 1))), 
            inherit.aes = FALSE, size = 3) +
  labs(x = "Days After Start", y = "Pot Weight (g)",
       fill = "Light", color = "Weight", title = "Normalized Transpiration (water/biomass)") +
  pcv_theme() +
  theme(legend.position = "bottom")

p2 + p1 + patchwork::plot_layout(widths = c(2, 1))
```

## WUE

Another important water metric is water use efficiency. Water use efficiency is generally calculated as a rate of biomass gained per unit of water.

$\frac{\Delta(\text{Biomass})_t}{\text{Water Transpired}_t}$

WUE might also be considered as the amount of water used to sustain a given biomass, which here is referred to as "absolute WUE".

$\frac{\text{Biomass}_t}{\text{Water Transpired}_t}$

### PWUE

Both WUE methods require a measure of biomass. Generally in high-throughput plant phenotyping we use a proxy for biomass, such as area (number of pixels labelled as a plant). Because we are using a proxy for biomass we have to call image-based WUE *Pseudo-Water Use Efficiency* (pWUE).

In `pcvr` the `pwue` function calculates normalized transpiration, rate based pWUE, and absolute pWUE.

## Reading in water data

In this article we'll use simulated data, but the `bw.water` function may be helpful for you reading in JSON Lemnatech metadata.

Here for more control we'll use simulated data:

#### Simulated Data

We'll simulate 5 groups of data with distinct watering and growth trends that we will go over next.

```{r}
set.seed(123)
days <- 25
n_plants <- 10
treatments <- LETTERS[1:5]

models <- c("logistic", "logistic", "exponential", "logistic", "logistic")
names(models) <- treatments

Apheno <- list(A = 30, B = 3, C = 5) # trash plants
Bpheno <- list(A = 40, B = 3, C = 4) # more trash plants
Cpheno <- list(A = 1, B = 0.2) # growth speeding up
Dpheno <- list(A = 200, B = 12, C = 3.5) # "normal" sigmoid
Epheno <- list(A = 200, B = 12, C = 3.5) # "normal" sigmoid

Awater <- rep(15, days) # constant watering
Bwater <- c(rep(20, floor(days/2)), rep(10, ceiling(days/2))) # decreasing watering
Cwater <- (days * 2) + 5 - (2 * seq_len(days)) # constant decrease watering
Dwater <- rep(25, days) # constant watering
Ewater <- (seq_len(days) * 2) + 5 # increasing watering

ex <- do.call(rbind, lapply(treatments, function(trt) {
  # make phenotypes with growthSim and Xpheno
  df <- pcvr::growthSim(models[[trt]], n = n_plants, t = days,
                        params = get(paste0(trt, "pheno")))
  df$group <- trt
  colnames(df)[4] <- "area"
  # for each plant
  do.call(rbind, lapply(unique(df$id), function(i) {
    # subset data
    sub <- df[df$id == i, ]
    # translate phenotype to a biomass (noisily, images aren't perfect)
    b <- sub$area * rbeta(days, 200, 200)
    # add water based on Xwater
    w <- b + get(paste0(trt, "water"))
    # add columns
    sub$weight_before <- b
    sub$weight_after <- w
    return(sub)
  }))
}))
```

#### Traits of the simulated data

The 5 groups of simulated data show several possible ways water use phenotypes can look. This is far
from an exhaustive list but hopefully helps make patterns in your data more interpretable. While talking about these data we are assuming that the watering is basically analogous to the transpired amount of water.

- `A`: The phenotype has essentially stagnated, there are very small changes measurement-to-measurement
and watering is constant throughout the experiment.

- `B`: The phenotype has essentially stagnated, there are very small changes measurement-to-measurement
and watering changes from one set amount to another set amount about halfway through the experiment.

- `C`: The phenotype is changing more quickly over time (exponential growth), meaning that for each new
measurement the measurement-to-measurement change is higher. Watering is decreasing over time.

- `D`: The phenotype is increasing over time in a pretty standard sigmoid pattern with constant
watering.

- `E`: The phenotype is increasing over time in a pretty standard sigmoid pattern while watering is
also increasing over time.

```{r}
ggplot(ex, aes(time, area, group = interaction(group, id))) +
  facet_wrap(~group) +
  geom_line(aes(color = group)) +
  geom_point(aes(color = group), size = 0.7) +
  labs(y = expression("Area (cm"^2*")"),
       x = "Time",
       title = "Treatments with several different growth trends") +
  pcv_theme() +
  theme(legend.position = "none")
```

```{r}
l <- reshape2::melt(ex, id.vars = c("id", "group", "time"),
                    measure.vars = c("weight_before", "weight_after"))

ggplot(l[l$id %in% paste0("id_", 1), ],
       aes(x = time + ifelse(variable == "weight_before", -0.25, 0.25), y = value, color = variable)) +
  facet_wrap(~group) +
  geom_line(color = "black") +
  geom_point() +
  labs(y = "Weight", x = "Time",
       title = "Treatments with several different watering schemes") +
  pcv_theme()
```



### Water data diagnostic plots

Before working with water derived metrics it's generally good to get a feeling for the raw watering data with similar plots as we used early on. Here we're checking that there are reasonable looking differences between subsequent weights, that any treatment groups have the expected watering pattern, and that the weight before watering is lower than the previous post-watering weight (indicating that transpiration happened).

```{r, echo = FALSE}
ggplot(l[l$id %in% paste0("id_", 1:3), ],
       aes(x = time + ifelse(variable == "weight_before", -0.25, 0.25),
           y = value, color = variable)) +
  facet_grid(id~group) +
  geom_line(color = "black") +
  geom_point(size = 0.5) +
  labs(y = "Weight", x = "Time",
       title = "Treatments with several different watering schemes") +
  pcv_theme()
```

Here we don't see anything that raises red flags, so we'll move on.

## `pwue`

The `pwue` function takes one or two dataframes as input. If one dataframe is given then it should include phenotypes and watering amounts and is expected in wide format. If two dataframes are given then one should contain phenotypes and the other should contain watering data.
The `pheno`, `time`, and `id` arguments control which variables are used to normalize for plant size (`pheno`), subset the data to a given time (`time`) and to identify a plant over time (`id`).
The `offset` argument optionally controls how long before a phenotype's measurement water has to have been added to count towards that phenotype, normally this is left 0.
`pre_watering` and `post_watering` should name columns of the dataframe containing water information corresponding to pre-watering weight and post-watering weight.
Finally, the `method` argument controls which values are calculated. Currently it accepts "rate", "abs", and "ndt" for the rate based pWUE, absolute value pWUE, and Normalized Daily Transpiration.

Note that here we are using very coarse measurements of time and for some experiments more granular time data is essential.

### Rate Based

```{r}
rb <- pwue(df = ex, w = NULL, pheno = "area", time = "time", id = c("id", "group"),
           pre_watering = "weight_before",
           post_watering = "weight_after", method = "rate")
```

```{r}
ggplot(rb[rb$id == "id_1", ], aes(x = time, y = pWUE, group = id)) +
  facet_wrap(~group) +
  geom_point() +
  geom_line() +
  pcv_theme()
```

Remember that the rate-based pWUE formula we are using is $\frac{\Delta(\text{Biomass})_t}{\text{Water Transpired}_t}$. Groups `A` and `B` are always going to have small values for pWUE since the change in size between any two measurements is very small. If we zoom in then there should be a downward trend. That trend will be driven entirely by the phenotype increasing by small amounts towards an asymptotic limit. Group `A` shows slow logistic growth with a low asymptote when compared to our other groups, if we zoom in on that phenotype data then the pWUE values start to make more sense.

```{r}
ggplot(rb[rb$group == "A" & rb$id %in% paste0("id_", 1:4), ],
       aes(x = time, y = pWUE, group = id)) +
  facet_wrap(~id) +
  geom_point() +
  geom_line() +
  labs(title = "Group A has a non-zero trend when we look more closely at it") +
  pcv_theme()
```

```{r}
ggplot(ex[ex$group == "A", ],
       aes(time, area, group = interaction(group, id))) +
  facet_wrap(~group) +
  geom_line(aes(color = group)) +
  geom_point(aes(color = group), size = 0.7) +
  labs(y = expression("Area (cm"^2*")"),
       x = "Time",
       title = "Zooming in on the phenotype data for group A") +
  pcv_theme() +
  theme(legend.position = "none")
```

The measurement-to-measurement change for any asymptotic phenotype approaches 0 at the same rate as the phenotype approaches the asymptote. This measurement-to-measurement change is returned from `pwue` as the `pheno_diff` column.

```{r}
pheno_diff_ag <- aggregate(cbind(area, pheno_diff) ~ time + group,
                           rb[rb$time %% 2 == 0, ], mean, na.rm = TRUE)

ggplot(ex[ex$group == "A", ],
       aes(time, area)) +
  facet_wrap(~group) +
  geom_line(aes(color = group, group = interaction(group, id))) +
  geom_point(aes(color = group), size = 0.7) +
  geom_label(data = pheno_diff_ag[pheno_diff_ag$group == "A", ],
            aes(label = round(pheno_diff, 1))) +
  labs(y = expression("Area (cm"^2*")"),
       x = "Time",
       title = "Labeling the average pheno_diff ever other day") +
  pcv_theme() +
  theme(legend.position = "none")
```

Group `B` has the same phenotype as Group `A`, but this time the watering scheme changes halfway through the experiment, which for our pWUE phenotype will divide the denominator by 2 around the halfway mark, so we should see a small disruption in the downward trend halfway through.

```{r}
ggplot(rb[rb$group == "B" & rb$id %in% paste0("id_", 1:4), ],
       aes(x = time, y = pWUE, group = id)) +
  facet_wrap(~id) +
  geom_point() +
  geom_line() +
  labs(title = "Group B has a 'hiccup' from the watering change") +
  pcv_theme()
```

```{r}
ggplot(ex[ex$group == "B", ],
       aes(time, area, group = interaction(group, id))) +
  facet_wrap(~group) +
  geom_line(aes(color = group)) +
  geom_point(aes(color = group), size = 0.7) +
  labs(y = expression("Area (cm"^2*")"),
       x = "Time",
       title = "Zooming in on the phenotype data for group B") +
  pcv_theme() +
  theme(legend.position = "none")
```

Groups `A` and `B` should also show the importance of looking at water-use phenotypes with free scales if you facet on treatments/genotypes/other groups in the data. All the phenotypes could be visualized fine with the same Y-axis scale, but the initial pWUE plot appeared as if Groups `A` and `B` were flat at 0. *Note that whether the difference from 0 is biologically meaningful is a separate question.*

Now we can move on to Group `C`, which had a massive jolt in the pWUE data near the end of the experiment.

```{r}
p <- ggplot(rb[rb$group == "C", ],
       aes(x = time, y = pWUE, group = id)) +
  facet_wrap(~group) +
  geom_point() +
  geom_line() +
  labs(title = "Group C has much messier trend towards the end") +
  pcv_theme()
p
```

If we zoom in then there does seem to be a trend that matches our expectation based on the phenotype, but it is very messy.

```{r}
p +
  coord_cartesian(ylim = c(-3, 10))
```

Remember that Group `C` has the amount of water used decreasing over time, that means that the denominator of our pWUE equation can get really small, which would push our pWUE values very high. Since our phenotype is also changing very quickly it can be hard to see in the initial plot we made of weight changes at each watering time, but there are some places in this data where the `total_water` value is negative. That technically should not happen, it would mean the plant has gained weight independently of being watered. In reality this sort of thing shows up all the time due to all sorts of sources of noise.

```{r}
summary(rb[rb$group == "C", "total_water"])
```

We know that something is wrong with these, so we'll remove any negative values.

```{r}
rbc <- rb[which(rb$group == "C" & rb$total_water > 0), ]

ggplot(rbc[rbc$group == "C", ],
       aes(x = time, y = pWUE, group = id)) +
  facet_wrap(~group) +
  geom_point() +
  geom_line() +
  labs(title = "Much better once we remove negative values") +
  pcv_theme()
```

With the numerator increasing over time (since the phenotype is increasing more between each measurement) and the denominator is decreasing over time (since we are watering less and less) we have a roughly exponential trend.

```{r}
ggplot(rbc[rbc$group == "C", ],
       aes(x = time, group = id)) +
  facet_wrap(~group) +
  geom_point(aes(y = total_water, color = "Water (denominator)")) +
  geom_line(aes(y = total_water, color = "Water (denominator)")) +
  geom_point(aes(y = pheno_diff, color = "Phenotype (numerator)")) +
  geom_line(aes(y = pheno_diff, color = "Phenotype (numerator)")) +
  labs(title = "Components of Rate pWUE",
       y = "Pheno Diff and Water Diff", x = "Time") +
  pcv_theme() +
  theme(legend.position = "bottom")
```


Thinking about Group `D`, with a sigmoidal phenotype and constant watering, we should be starting to build intuition to say that rate based pWUE will look something like a bell curve over time since the denominator is a constant and the numerator is going to increase then decrease (as sigmoidal growth speeds up then slows down as it approaches then passes the inflection point).

Looking at Group `D` now we have another negative value which makes it hard to see any clear trend at this scale, so we'll remove that.

```{r}
ggplot(rb[rb$group == "D", ],
       aes(x = time, y = pWUE, group = id)) +
  geom_point() +
  geom_line() +
  labs(title = "Negative values are difficult to read around sometimes, easiest to remove them.") +
  pcv_theme()
```

```{r}
rbd <- rb[which(rb$group == "D" & rb$total_water > 0), ]
ggplot(rbd,
       aes(x = time, y = pWUE, group = id)) +
  geom_point() +
  geom_line() +
  labs(title = "Intuition paid off, D follow the expected pattern") +
  pcv_theme()
```

Why does the Group `D` data look so spikey though?

```{r}
ggplot(rbd,
       aes(x = time, group = id)) +
  facet_wrap(~id)+
  geom_point(aes(y = total_water, color = "Water (denominator)")) +
  geom_line(aes(y = total_water, color = "Water (denominator)")) +
  geom_point(aes(y = pheno_diff, color = "Phenotype (numerator)")) +
  geom_line(aes(y = pheno_diff, color = "Phenotype (numerator)")) +
  labs(title = "Intuition paid off, D follow the expected pattern",
       y = "Pheno Diff and Water Diff", x = "Time") +
  pcv_theme() +
  theme(legend.position = "bottom")
```

Here we see that the spikey-ness is coming from the watering data, which is essentially random noise centered around 10 after the first few days. Since the measurement-to-measurement difference in the phenotype is so regular (phenotypes were simulated from a monotone-increasing logistic function with only small amounts of noise) there are times where we're dividing the largest measurement-to-measurement difference by one of the smallest amounts of water used, which makes a "spike" in our pWUE.

Finally we can look at Group `E` where we have the same type of logistic growth as Group `D`, but with water (use) increasing continuously over the course of the experiment. We know the measurement-to-measurement change in our phenotype will be roughly gaussian over time, starting around 0, increasing until the inflection point time, then decreasing back towards 0 as we approach the asymptote. So if we add more water over time then we should see a bell shaped curve that ends lower than it begins (small numerator / small denominator at the start, then small numerator / large denominator at the end).

```{r}
ggplot(rb[rb$group == "E", ],
       aes(x = time, y = pWUE, group = id)) +
  geom_point() +
  geom_line() +
  labs(title = "The effect of increasing water over time given an asymptotic phenotype") +
  pcv_theme()
```

Exactly as expected, with the normal noisiness we expect from our simulation (and realistically probably from real data).

```{r}
ggplot(rb[rb$group == "E", ],
       aes(x = time, group = id)) +
  facet_wrap(~id)+
  geom_point(aes(y = total_water, color = "Water (denominator)")) +
  geom_line(aes(y = total_water, color = "Water (denominator)")) +
  geom_point(aes(y = pheno_diff, color = "Phenotype (numerator)")) +
  geom_line(aes(y = pheno_diff, color = "Phenotype (numerator)")) +
  labs(title = "To be complete we have this plot for E",
       y = "Pheno Diff and Water Diff", x = "Time") +
  pcv_theme() +
  theme(legend.position = "bottom")
```

### Absolute Value Based

### Normalized Daily Transpiration

## field capacity equations

## Next Steps



