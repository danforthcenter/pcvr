% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/pcvjoyplot.R
\name{pcv.joyplot}
\alias{pcv.joyplot}
\title{Make Joyplots for multi value trait plantCV data and optionally compare distributions}
\usage{
pcv.joyplot(
  df = NULL,
  index = NULL,
  group = NULL,
  method = NULL,
  compare = NULL,
  priors = NULL,
  hyp = NULL,
  bin = "label",
  freq = "value",
  trait = "trait",
  fillx = T
)
}
\arguments{
\item{df}{Data frame to use. Long or wide format is accepted.}

\item{index}{If the data is long then this is a multi value trait as a character string that must be present in `trait`. If the data is wide then this is a string used to find column names to use from the wide data. In the wide case this should include the entire trait name (ie, "hue_frequencies" instead of "hue_freq").}

\item{group}{A length 1 or 2 character vector. This is used for faceting the joyplot and identifying groups for testing. If this is length 1 then no faceting is done.}

\item{method}{A method to use in comparing distributions/means. Currently "beta", "gaussian", "emd", and "ks" are supported. See details for explanations of tests.}

\item{compare}{Groups to compare. By default this is set to FALSE, which corresponds to no testing. Other values of compare are passed to fixCompare to make t.test comparisons using ggpubr. In short, NULL will run all pairwise T tests, a single value of the X axis variable will compare that level to all other levels of the X variable, alternatively this can be a list as used by ggpubr: list(c("level1", "level2"), c("level1", "level3"))}

\item{priors}{Parameters for prior distributions if using method = "beta" or "gaussian". If left NULL then wide weak priors are used. This can be set as a single set of parameters or with unique values for each group in `compare`, but it is advised to use the default priors.}

\item{hyp}{Hypothesis to test for beta and gaussian methods, one of "unequal", "greater", "lesser". Defaults to "unequal" if left NULL.}

\item{bin}{Column containing histogram (multi value trait) bins. Defaults to "label".}

\item{freq}{Column containing histogram counts. Defaults to "value"}

\item{trait}{Column containing phenotype names. Defaults to "trait".}

\item{fillx}{Logical, whether or not to use \code{ggridges::geom_density_ridges_gradient} . Default is T, if F then \code{ggridges::geom_density_ridges} is used instead, with arbitrary fill. Note that \code{ggridges::geom_density_ridges_gradient} may issue a message about deprecated ggplot2 features.}
}
\value{
Returns either a ggplot object or a list containing a ggplot and a dataframe of statistical comparisons (if compare is not FALSE).
}
\description{
Make Joyplots for multi value trait plantCV data and optionally compare distributions
}
\details{
The method argument is used for statistical testing of groups. There are currently four options, "beta", "gaussian", "ks", and "emd".
\itemize{
 \item{"beta"}{The beta method is for use with bounded data (0,1) and creates a posterior beta distribution using the histogram counts and bins and priors (which default to beta(0.5,0.5)). The posterior distributions are compared across the groups in `compare` and a posterior probability is returned for each which corresponds to P[hyp]. }
 \item{"gaussian"}{The gaussian method is for use with multi value traits that are not bounded 0-1 and are roughly gaussian. Like the beta method this assumes weak priors and uses the histogram data to make a posterior distribution (here a T distribution). Here there will be two posterior probabilities returned for each comparison, one compares the distribution of means only and is roughly analogous to a T test, the other compares the entire posterior distributions and is more similar to a Z test. The posterior probability still takes the form P[hyp]. Note that currently these consider pixels as reps, so it is easy to have very small biological changes at very high posterior probability.}
 \item{"ks"}{The ks method performs a ks test on the PDF of each histogram over a set support range. This returns a P value corresponding to a standard KS test that distributions are the same. For this method `hyp` is ignored.}
 \item{"emd}{The emd method returns earth mover's distance for compared histograms. This is done via the emdist package and can be very slow. This is included because it is canonical but in the case where EMD is desired it may be worth implementing it directly.}
}
}
\examples{
df <- read.pcv("https://raw.githubusercontent.com/joshqsumner/pcvrTestData/main/pcvrTest2.csv", "long", F)
wide_beta <- read.pcv("https://raw.githubusercontent.com/joshqsumner/pcvrTestData/main/pcvrTest2.csv", "wide", F)
pcv.joyplot(df, index = "index_frequencies_index_ndvi", group=c("genotype", "timepoint"))
pcv.joyplot(df, index = "index_frequencies_index_ndvi", group=c("genotype", "timepoint"), method="ks")
pcv.joyplot(df, index = "index_frequencies_index_ndvi", group=c("genotype", "timepoint"), method="beta")
pcv.joyplot(df, index = "index_frequencies_index_ndvi", group=c("genotype", "timepoint"), method="gaussian")

wide<-read.pcv("https://media.githubusercontent.com/media/joshqsumner/pcvrTestData/main/smallPhenotyperRun.csv", mode="wide", singleValueOnly = T, multiValPattern = "hist", reader="fread")
wide$genotype = substr(wide$barcode, 3,5)
wide$genotype = ifelse(wide$genotype == "002", "B73",
                       ifelse(wide$genotype == "003", "W605S",
                              ifelse(wide$genotype == "004", "MM", "Mo17")))
wide$fertilizer = substr(wide$barcode, 8, 8)
wide$fertilizer = ifelse(wide$fertilizer == "A", "100",
                         ifelse(wide$fertilizer == "B", "50", "0"))
p<-pcv.joyplot(wide, index = "hue_frequencies", group=c("genotype", "fertilizer"))
# For some color traits it makes sense to show the actual represented color, which can be done easily by adding new fill scales.
p+scale_fill_gradientn(colors = scales::hue_pal(l=65)(360))
}
\keyword{bayesian,}
\keyword{ggplot,}
\keyword{multi}
\keyword{pcv.hists}
\keyword{trait,}
\keyword{value}
