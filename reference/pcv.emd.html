<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Earth Mover's Distance between spectral histograms — pcv.emd • pcvr</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Earth Mover's Distance between spectral histograms — pcv.emd"><meta name="description" content="pcv.emd can be used to calculate Earth Mover's Distance between pairwise histograms
in a wide dataframe of multi value traits. The is expected to be used with output from mv_ag.
See also pcv.euc for euclidean distance between histograms."><meta property="og:description" content="pcv.emd can be used to calculate Earth Mover's Distance between pairwise histograms
in a wide dataframe of multi value traits. The is expected to be used with output from mv_ag.
See also pcv.euc for euclidean distance between histograms."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">pcvr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes"><li><a class="dropdown-item" href="../articles/bellwether.html">Bellwether</a></li>
    <li><a class="dropdown-item" href="../articles/longitudinal.html">Longitudinal Modeling</a></li>
    <li><a class="dropdown-item" href="../articles/roots.html">Root Phenotyping</a></li>
    <li><a class="dropdown-item" href="../articles/directional.html">Directional Statistics</a></li>
    <li><a class="dropdown-item" href="../articles/installation.html">Installation Tutorial</a></li>
    <li><a class="dropdown-item" href="../articles/pcvrTutorial_conjugate.html">Conjugate Tutorial</a></li>
    <li><a class="dropdown-item" href="../articles/pcvrTutorial_igm.html">Intermediate Growth Modeling Tutorial</a></li>
    <li><a class="dropdown-item" href="../articles/pcvrTutorial_agm.html">Advanced Growth Modeling Tutorial</a></li>
    <li><a class="dropdown-item" href="../articles/pcvrTutorial_mvt.html">Multi-Value Traits Tutorial</a></li>
  </ul></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-quarto-tutorials" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Quarto Tutorials</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-quarto-tutorials"><li><a class="external-link dropdown-item" href="https://github.com/danforthcenter/pcvr/tree/main/tutorials/pcvrInstallation">Installation</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/danforthcenter/pcvr/tree/main/tutorials/pcvrTutorial_intro">Intro</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/danforthcenter/pcvr/tree/main/tutorials/pcvrTutorial_intermediateGrowthModeling">Growth Modeling</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/danforthcenter/pcvr/tree/main/tutorials/pcvrTutorial_advancedGrowthModeling">Advanced Growth Modeling</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/danforthcenter/pcvr/tree/main/tutorials/pcvrTutorial_conjugate">Bayesian Conjugate Priors</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/danforthcenter/pcvr/tree/crop_reporter/tutorials/pcvrTutorial_multiValueTraits">Multi-Value Traits</a></li>
  </ul></li>
<li class="nav-item"><a class="external-link nav-link" href="https://plantcv.org/">PlantCV</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/danforthcenter/pcvr"><span class="fa fa-github"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/danforthcenter/PlantCV"><span class="fa fa-leaf"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Earth Mover's Distance between spectral histograms</h1>
      <small class="dont-index">Source: <a href="https://github.com/danforthcenter/pcvr/blob/main/R/emd.R" class="external-link"><code>R/emd.R</code></a></small>
      <div class="d-none name"><code>pcv.emd.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>pcv.emd can be used to calculate Earth Mover's Distance between pairwise histograms
in a wide dataframe of multi value traits. The is expected to be used with output from <code>mv_ag</code>.
See also pcv.euc for euclidean distance between histograms.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">pcv.emd</span><span class="op">(</span></span>
<span>  <span class="va">df</span>,</span>
<span>  cols <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  reorder <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  include <span class="op">=</span> <span class="va">reorder</span>,</span>
<span>  mat <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  plot <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  parallel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"mc.cores"</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  trait <span class="op">=</span> <span class="st">"trait"</span>,</span>
<span>  id <span class="op">=</span> <span class="st">"image"</span>,</span>
<span>  value <span class="op">=</span> <span class="st">"value"</span>,</span>
<span>  raiseError <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"emd"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">pcv.euc</span><span class="op">(</span></span>
<span>  <span class="va">df</span>,</span>
<span>  cols <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  reorder <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  include <span class="op">=</span> <span class="va">reorder</span>,</span>
<span>  mat <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  plot <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  parallel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"mc.cores"</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  trait <span class="op">=</span> <span class="st">"trait"</span>,</span>
<span>  id <span class="op">=</span> <span class="st">"image"</span>,</span>
<span>  value <span class="op">=</span> <span class="st">"value"</span>,</span>
<span>  raiseError <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"euc"</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-df">df<a class="anchor" aria-label="anchor" href="#arg-df"></a></dt>
<dd><p>Data frame to use with multi value traits in wide format or long format</p></dd>


<dt id="arg-cols">cols<a class="anchor" aria-label="anchor" href="#arg-cols"></a></dt>
<dd><p>Columns to use. Defaults to NULL in which case all columns are used.
Single strings will be used to regex a pattern in column names (see examples).
 A vector of names, positions, or booleans will also work.
 For long data this is taken as a regex pattern (or full name)
 to use in filtering the trait column.</p></dd>


<dt id="arg-reorder">reorder<a class="anchor" aria-label="anchor" href="#arg-reorder"></a></dt>
<dd><p>Should data be reordered to put similar rows together in the resulting plot?
This takes a vector of column names of length 1 or more (see examples).</p></dd>


<dt id="arg-include">include<a class="anchor" aria-label="anchor" href="#arg-include"></a></dt>
<dd><p>if a long dataframe is returned then these columns will be added to the dataframe,
labelled for i and j (the row positions for compared histograms).
If a matrix is returned then this information is stored in the row names.
This defaults to reorder.</p></dd>


<dt id="arg-mat">mat<a class="anchor" aria-label="anchor" href="#arg-mat"></a></dt>
<dd><p>Logical, should data be returned as an nrow x nrow matrix or as a long dataframe?
By Default this is FALSE and a long dataframe is returned.
Both options are comparable in terms of speed,
although for large datasets the matrix version may be slightly faster.</p></dd>


<dt id="arg-plot">plot<a class="anchor" aria-label="anchor" href="#arg-plot"></a></dt>
<dd><p>Logical, should a plot be returned? For a matrix this is made with heatmap(),
for a dataframe this uses ggplot.</p></dd>


<dt id="arg-parallel">parallel<a class="anchor" aria-label="anchor" href="#arg-parallel"></a></dt>
<dd><p>Number of cores to use. Defaults to 1 unless the "mc.cores" option is set.</p></dd>


<dt id="arg-trait">trait<a class="anchor" aria-label="anchor" href="#arg-trait"></a></dt>
<dd><p>Column name for long data to identify traits. This defaults to "trait". If this and
value are in the column names of the data then it is assumed to be in long format,
otherwise it is assumed to be in wide format.</p></dd>


<dt id="arg-id">id<a class="anchor" aria-label="anchor" href="#arg-id"></a></dt>
<dd><p>A vector of column names that uniquely identifies observations if the
data is in long format. Defaults to "image".</p></dd>


<dt id="arg-value">value<a class="anchor" aria-label="anchor" href="#arg-value"></a></dt>
<dd><p>A column name for the values to be drawn from in long data.
Defaults to "value".</p></dd>


<dt id="arg-raiseerror">raiseError<a class="anchor" aria-label="anchor" href="#arg-raiseerror"></a></dt>
<dd><p>Logical, should warnings/errors be raised for potentially large output?
It is easy to ask for very many comparisons with this function so the goal of this argument
is to catch a few of those and give estimates of how much time something may take.
 If the function is expected to take very long then a warning or an error is raised.
  If this is set to FALSE then no time estimates are made.</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>Which method to use (one of "emd" or "euc"). Defaults to "emd".</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A dataframe/matrix (if plot=FALSE) or a list with a dataframe/matrix and\
a ggplot (if plot=TRUE). The returned data contains pairwise EMD values.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">test</span> <span class="op">&lt;-</span> <span class="fu"><a href="mvSim.html">mvSim</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  dists <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    runif <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    rnorm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">90</span>, sd <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>,</span></span>
<span class="r-in"><span>  n_samples <span class="op">=</span> <span class="fl">10</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">test</span><span class="op">$</span><span class="va">meta1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, length.out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">test</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">test</span><span class="op">$</span><span class="va">meta2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">LETTERS</span><span class="op">[</span><span class="fl">4</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, length.out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">test</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">pcv.emd</span><span class="op">(</span></span></span>
<span class="r-in"><span>  df <span class="op">=</span> <span class="va">test</span>, cols <span class="op">=</span> <span class="st">"sim"</span>, reorder <span class="op">=</span> <span class="st">"group"</span>,</span></span>
<span class="r-in"><span>  include <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"meta1"</span>, <span class="st">"meta2"</span><span class="op">)</span>, mat <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>  plot <span class="op">=</span> <span class="cn">FALSE</span>, parallel <span class="op">=</span> <span class="fl">1</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Estimated time of calculation is roughly 0.5 seconds using 1 cores in parallel.</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     i j   emd meta1_i meta2_i meta1_j meta2_j</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11  1 1 0.000       B       D       B       D</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 111 1 1 0.000       B       D       B       D</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 112 1 2 1.463       B       D       C       E</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12  2 1 1.463       C       E       B       D</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 113 1 3 0.813       B       D       A       D</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13  3 1 0.813       A       D       B       D</span>
<span class="r-in"><span><span class="va">x2</span> <span class="op">&lt;-</span> <span class="fu">pcv.emd</span><span class="op">(</span></span></span>
<span class="r-in"><span>  df <span class="op">=</span> <span class="va">test</span>, cols <span class="op">=</span> <span class="st">"sim"</span>, reorder <span class="op">=</span> <span class="st">"group"</span>,</span></span>
<span class="r-in"><span>  include <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"meta1"</span>, <span class="st">"meta2"</span><span class="op">)</span>, mat <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>  plot <span class="op">=</span> <span class="cn">FALSE</span>, parallel <span class="op">=</span> <span class="fl">1</span>, method <span class="op">=</span> <span class="st">"euc"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Estimated time of calculation is roughly 0.5 seconds using 1 cores in parallel.</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">x2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     i j        euc meta1_i meta2_i meta1_j meta2_j</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11  1 1 0.00000000       B       D       B       D</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 111 1 1 0.00000000       B       D       B       D</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 112 1 2 0.04901020       B       D       C       E</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12  2 1 0.04901020       C       E       B       D</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 113 1 3 0.04501111       B       D       A       D</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13  3 1 0.04501111       A       D       B       D</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>      <span class="st">"https://media.githubusercontent.com/media/joshqsumner/"</span>,</span></span>
<span class="r-in"><span>      <span class="st">"pcvrTestData/main/pcv4-multi-value-traits.csv"</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">df1</span> <span class="op">&lt;-</span> <span class="fu"><a href="read.pcv.html">read.pcv</a></span><span class="op">(</span><span class="va">file</span>, <span class="st">"wide"</span>, reader <span class="op">=</span> <span class="st">"fread"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="va">df1</span><span class="op">$</span><span class="va">genotype</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">df1</span><span class="op">$</span><span class="va">barcode</span>, <span class="fl">3</span>, <span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">df1</span><span class="op">$</span><span class="va">genotype</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">df1</span><span class="op">$</span><span class="va">genotype</span> <span class="op">==</span> <span class="st">"002"</span>, <span class="st">"B73"</span>,</span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">df1</span><span class="op">$</span><span class="va">genotype</span> <span class="op">==</span> <span class="st">"003"</span>, <span class="st">"W605S"</span>,</span></span>
<span class="r-in"><span>        <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">df1</span><span class="op">$</span><span class="va">genotype</span> <span class="op">==</span> <span class="st">"004"</span>, <span class="st">"MM"</span>, <span class="st">"Mo17"</span><span class="op">)</span></span></span>
<span class="r-in"><span>      <span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">df1</span><span class="op">$</span><span class="va">fertilizer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">df1</span><span class="op">$</span><span class="va">barcode</span>, <span class="fl">8</span>, <span class="fl">8</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">df1</span><span class="op">$</span><span class="va">fertilizer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">df1</span><span class="op">$</span><span class="va">fertilizer</span> <span class="op">==</span> <span class="st">"A"</span>, <span class="st">"100"</span>,</span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">df1</span><span class="op">$</span><span class="va">fertilizer</span> <span class="op">==</span> <span class="st">"B"</span>, <span class="st">"50"</span>, <span class="st">"0"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="va">w</span> <span class="op">&lt;-</span> <span class="fu">pcv.emd</span><span class="op">(</span><span class="va">df1</span>,</span></span>
<span class="r-in"><span>      cols <span class="op">=</span> <span class="st">"hue_frequencies"</span>, reorder <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fertilizer"</span>, <span class="st">"genotype"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>      mat <span class="op">=</span> <span class="cn">FALSE</span>, plot <span class="op">=</span> <span class="cn">TRUE</span>, parallel <span class="op">=</span> <span class="fl">1</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span>,</span></span>
<span class="r-in"><span>  error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">err</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="va">err</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in .emdRaiseError(raiseError, df, parallel, trait = NULL):</span> Stopping, estimated time of calculation is roughly 2.83 hours using 1 cores in parallel.</span>
<span class="r-err co"><span class="r-pr">#&gt;</span> If you wish to proceed then rerun this command with raiseError=FALSE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Note on computational complexity</span></span></span>
<span class="r-in"><span><span class="co"># This scales as O^2, see the plot below for some idea</span></span></span>
<span class="r-in"><span><span class="co"># of the time for different input data sizes.</span></span></span>
<span class="r-in"><span><span class="va">emdTime</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">n</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">x</span><span class="op">^</span><span class="fl">2</span> <span class="op">/</span> <span class="va">n</span> <span class="op">*</span> <span class="fl">0.0023</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">18</span>, <span class="fl">36</span>, <span class="fl">54</span>, <span class="fl">72</span>, <span class="fl">108</span>, <span class="fl">135</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.74</span>, <span class="fl">2.89</span>, <span class="fl">6.86</span>, <span class="fl">10.99</span>, <span class="fl">26.25</span>, <span class="fl">42.44</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  xlab <span class="op">=</span> <span class="st">"N Input Images"</span>, ylab <span class="op">=</span> <span class="st">"time (seconds)"</span></span></span>
<span class="r-in"><span><span class="op">)</span> <span class="co"># benchmarked test data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">150</span>, y <span class="op">=</span> <span class="fu">emdTime</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">150</span><span class="op">)</span><span class="op">)</span> <span class="co"># exponential function</span></span></span>
<span class="r-plt img"><img src="pcv.emd-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">1000</span>, y <span class="op">=</span> <span class="fu">emdTime</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">1000</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"l"</span>,</span></span>
<span class="r-in"><span>  xlab <span class="op">=</span> <span class="st">"N Input Images"</span>, ylab <span class="op">=</span> <span class="st">"time (seconds)"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="pcv.emd-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Maintained by Josh Sumner <br> Developed in DDPSC Datascience Core Facility <br> Logo design by <a href="https://twitter.com/Kerri_Gilbert" class="external-link">Kerri Gilbert</a></p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

